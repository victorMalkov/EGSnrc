<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>EGSnrc C++ class library: /home/ftessier/EGSnrc/HEN_HOUSE/egs++/egs_advanced_application.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EGSnrc C++ class library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/home/ftessier/EGSnrc/HEN_HOUSE/egs++/egs_advanced_application.cpp</h1>  </div>
</div>
<div class="contents">
<a href="egs__advanced__application_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">###############################################################################</span>
<a name="l00003"></a>00003 <span class="comment">#</span>
<a name="l00004"></a>00004 <span class="comment">#  EGSnrc egs++ advanced application</span>
<a name="l00005"></a>00005 <span class="comment">#  Copyright (C) 2015 National Research Council Canada</span>
<a name="l00006"></a>00006 <span class="comment">#</span>
<a name="l00007"></a>00007 <span class="comment">#  This file is part of EGSnrc.</span>
<a name="l00008"></a>00008 <span class="comment">#</span>
<a name="l00009"></a>00009 <span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span>
<a name="l00010"></a>00010 <span class="comment">#  the terms of the GNU Affero General Public License as published by the</span>
<a name="l00011"></a>00011 <span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span>
<a name="l00012"></a>00012 <span class="comment">#  option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment">#</span>
<a name="l00014"></a>00014 <span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<a name="l00015"></a>00015 <span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00016"></a>00016 <span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span>
<a name="l00017"></a>00017 <span class="comment">#  more details.</span>
<a name="l00018"></a>00018 <span class="comment">#</span>
<a name="l00019"></a>00019 <span class="comment">#  You should have received a copy of the GNU Affero General Public License</span>
<a name="l00020"></a>00020 <span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00021"></a>00021 <span class="comment">#</span>
<a name="l00022"></a>00022 <span class="comment">###############################################################################</span>
<a name="l00023"></a>00023 <span class="comment">#</span>
<a name="l00024"></a>00024 <span class="comment">#  Author:          Iwan Kawrakow, 2005</span>
<a name="l00025"></a>00025 <span class="comment">#</span>
<a name="l00026"></a>00026 <span class="comment">#  Contributors:    Ernesto Mainegra-Hing</span>
<a name="l00027"></a>00027 <span class="comment">#                   Frederic Tessier</span>
<a name="l00028"></a>00028 <span class="comment">#                   Blake Walters</span>
<a name="l00029"></a>00029 <span class="comment">#</span>
<a name="l00030"></a>00030 <span class="comment">###############################################################################</span>
<a name="l00031"></a>00031 <span class="comment">*/</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="egs__advanced__application_8h.html" title="EGS_AdvancedApplication class header file.">egs_advanced_application.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="egs__functions_8h.html" title="Global egspp functions.">egs_functions.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;egs_interface2.h&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="egs__run__control_8h.html" title="Header file for run control objects.">egs_run_control.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="egs__base__source_8h.html" title="Base particle source header file.">egs_base_source.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html" title="EGS_Input header file.">egs_input.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="egs__interpolator_8h.html" title="A class for run-time interpolations.">egs_interpolator.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="egs__rndm_8h.html" title="Base random number generator.">egs_rndm.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="egs__ausgab__object_8h.html" title="An interface class for ausgab objects.">egs_ausgab_object.h</a>&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;cstdio&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;cstdarg&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="keyword">using namespace </span>std;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#ifdef DEBUG_APPLICATION</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#define CHECK_GET_APPLICATION(a,b) \</span>
<a name="l00062"></a>00062 <span class="preprocessor">    EGS_Application *a = EGS_Application::activeApplication(); \</span>
<a name="l00063"></a>00063 <span class="preprocessor">    if( !a ) egsFatal(&quot;%s: no active application!\n&quot;,b);</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#define CHECK_GET_APPLICATION(a,b) \</span>
<a name="l00066"></a>00066 <span class="preprocessor">    EGS_Application *a = EGS_Application::activeApplication();</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="keywordtype">string</span> <a class="code" href="classEGS__AdvancedApplication.html#a5e1130f43cd91b4718a62619525351a2" title="Holds the CVS revision number of the egs_advanced_application.cpp file.">EGS_AdvancedApplication::base_revision</a> = <span class="stringliteral">&quot;$Revision: 1.39 $&quot;</span>;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">/*</span>
<a name="l00072"></a>00072 <span class="comment">extern __extc__ struct EGS_Stack F77_OBJ(stack,STACK);</span>
<a name="l00073"></a>00073 <span class="comment">extern __extc__ struct EGS_Bounds F77_OBJ(bounds,BOUNDS);</span>
<a name="l00074"></a>00074 <span class="comment">extern __extc__ struct EGS_Thresh F77_OBJ(thresh,THRESH);</span>
<a name="l00075"></a>00075 <span class="comment">extern __extc__ struct EGS_Epcont F77_OBJ(epcont,EPCONT);</span>
<a name="l00076"></a>00076 <span class="comment">extern __extc__ struct EGS_EtControl F77_OBJ_(et_control,ET_CONTROL);</span>
<a name="l00077"></a>00077 <span class="comment">extern __extc__ struct EGS_Media F77_OBJ(media,MEDIA);</span>
<a name="l00078"></a>00078 <span class="comment">extern __extc__ struct EGS_Useful F77_OBJ(useful,USEFUL);</span>
<a name="l00079"></a>00079 <span class="comment">extern __extc__ struct EGS_XOptions F77_OBJ_(xsection_options,XSECTION_OPTIONS);</span>
<a name="l00080"></a>00080 <span class="comment">extern __extc__ struct EGS_IO F77_OBJ_(egs_io,EGS_IO);</span>
<a name="l00081"></a>00081 <span class="comment">extern __extc__ struct EGS_VarianceReduction F77_OBJ_(egs_vr,EGS_VR);</span>
<a name="l00082"></a>00082 <span class="comment"></span>
<a name="l00083"></a>00083 <span class="comment">struct EGS_Stack        *the_stack     = &amp; F77_OBJ(stack,STACK);</span>
<a name="l00084"></a>00084 <span class="comment">struct EGS_Bounds       *the_bounds    = &amp; F77_OBJ(bounds,BOUNDS);</span>
<a name="l00085"></a>00085 <span class="comment">struct EGS_Thresh       *the_thresh    = &amp; F77_OBJ(thresh,THRESH);</span>
<a name="l00086"></a>00086 <span class="comment">struct EGS_Epcont       *the_epcont    = &amp; F77_OBJ(epcont,EPCONT);</span>
<a name="l00087"></a>00087 <span class="comment">struct EGS_EtControl    *the_etcontrol = &amp; F77_OBJ_(et_control,ET_CONTROL);</span>
<a name="l00088"></a>00088 <span class="comment">struct EGS_Media        *the_media     = &amp; F77_OBJ(media,MEDIA);</span>
<a name="l00089"></a>00089 <span class="comment">struct EGS_Useful       *the_useful    = &amp; F77_OBJ(useful,USEFUL);</span>
<a name="l00090"></a>00090 <span class="comment">struct EGS_XOptions     *the_xoptions  = &amp; F77_OBJ_(xsection_options,XSECTION_OPTIONS);</span>
<a name="l00091"></a>00091 <span class="comment">struct EGS_IO           *the_egsio     = &amp; F77_OBJ_(egs_io,EGS_IO);</span>
<a name="l00092"></a>00092 <span class="comment">struct EGS_VarianceReduction *the_egsvr = &amp; F77_OBJ_(egs_vr,EGS_VR);</span>
<a name="l00093"></a>00093 <span class="comment">*/</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="preprocessor">#define egsGetRNGPointers F77_OBJ_(egs_get_rng_pointers,EGS_GET_RNG_POINTERS)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsGetRNGPointers(EGS_I32 *, EGS_I32 *);
<a name="l00097"></a>00097 <span class="preprocessor">#define egsGetRNGArray F77_OBJ_(egs_get_rng_array,EGS_GET_RNG_ARRAY)</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsGetRNGArray(EGS_Float *);
<a name="l00099"></a>00099 <span class="preprocessor">#define egsSetRNGState F77_OBJ_(egs_set_rng_state,EGS_SET_RNG_STATE)</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsSetRNGState(<span class="keyword">const</span> EGS_I32 *, <span class="keyword">const</span> EGS_Float *);
<a name="l00101"></a>00101 <span class="preprocessor">#define egsGetSteps F77_OBJ_(egs_get_steps,EGS_GET_STEPS)</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsGetSteps(<span class="keywordtype">double</span> *, <span class="keywordtype">double</span> *);
<a name="l00103"></a>00103 <span class="preprocessor">#define egsSetSteps F77_OBJ_(egs_set_steps,EGS_SET_STEPS)</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsSetSteps(<span class="keyword">const</span> <span class="keywordtype">double</span> *, <span class="keyword">const</span> <span class="keywordtype">double</span> *);
<a name="l00105"></a>00105 <span class="preprocessor">#define egsOpenUnits F77_OBJ_(egs_open_units,EGS_OPEN_UNITS)</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsOpenUnits(<span class="keyword">const</span> EGS_I32 *);
<a name="l00107"></a>00107 <span class="preprocessor">#define egsGetElectronData F77_OBJ_(egs_get_electron_data,EGS_GET_ELECTRON_DATA)</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsGetElectronData(<span class="keywordtype">void</span> (*func)(EGS_I32 *,EGS_Float *,
<a name="l00109"></a>00109                                         EGS_Float *,EGS_Float *,EGS_Float *),<span class="keyword">const</span> EGS_I32 *,<span class="keyword">const</span> EGS_I32 *);
<a name="l00110"></a>00110 <span class="preprocessor">#define egsGetPhotonData F77_OBJ_(egs_get_photon_data,EGS_GET_PHOTON_DATA)</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> egsGetPhotonData(<span class="keywordtype">void</span> (*func)(EGS_I32 *,EGS_Float *,
<a name="l00112"></a>00112                                       EGS_Float *,EGS_Float *,EGS_Float *),<span class="keyword">const</span> EGS_I32 *,<span class="keyword">const</span> EGS_I32 *);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="keyword">static</span> EGS_Float *__help1, *__help2, *__help3, *__help4;
<a name="l00115"></a>00115 <span class="keyword">static</span> EGS_I32 *__ihelp;
<a name="l00116"></a>00116 <span class="keyword">static</span> <span class="keywordtype">void</span> __help_get_data(EGS_I32 *nbin,EGS_Float *emin, EGS_Float *emax,
<a name="l00117"></a>00117                             EGS_Float *a, EGS_Float *b) {
<a name="l00118"></a>00118     __ihelp = nbin;
<a name="l00119"></a>00119     __help1 = emin;
<a name="l00120"></a>00120     __help2 = emax;
<a name="l00121"></a>00121     __help3 = a;
<a name="l00122"></a>00122     __help4 = b;
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="keyword">static</span> <span class="keywordtype">void</span> __init_interpolator(<span class="keywordtype">int</span> q, <span class="keywordtype">int</span> imed, <span class="keywordtype">int</span> type,
<a name="l00126"></a>00126                                 <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> &amp;i) {
<a name="l00127"></a>00127     <span class="keywordflow">if</span> (q) {
<a name="l00128"></a>00128         egsGetElectronData(__help_get_data,&amp;imed,&amp;type);
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130     <span class="keywordflow">else</span> {
<a name="l00131"></a>00131         egsGetPhotonData(__help_get_data,&amp;imed,&amp;type);
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133     i.<a class="code" href="classEGS__Interpolator.html#a120cc2e14abf920f87f49692bc8f9622" title="Initialize the interpolator.">initialize</a>(*__ihelp,*__help1,*__help2,__help3,__help4);
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="classEGS__AdvancedApplication.html#aa99e11b4787a5910d28c6afb14d090b2">00136</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#aa99e11b4787a5910d28c6afb14d090b2" title="Turns on or off a call to the user scoring function ausgab()">EGS_AdvancedApplication::setAusgabCall</a>(<a class="code" href="classEGS__Application.html#a824708ab25ce90310fdee8e8a7a4cd1a" title="Possible calls to the user scoring function ausgab().">AusgabCall</a> call, <span class="keywordtype">bool</span> on_or_off) {
<a name="l00137"></a>00137     \
<a name="l00138"></a>00138     <a class="code" href="classEGS__Application.html#a38bd7b0a03e87c07c63b0713da56518a" title="Turns on or off a call to the user scoring function ausgab.">EGS_Application::setAusgabCall</a>(call,on_or_off);
<a name="l00139"></a>00139     <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#af9aee75fae4d7e40b474d6dd0efaea37">iausfl</a>[call] = (int) on_or_off;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="keyword">static</span> EGS_LOCAL <span class="keywordtype">void</span> __egs_iovar(<span class="keywordtype">int</span> nio, <span class="keywordtype">int</span> ns,
<a name="l00143"></a>00143                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *source, <span class="keywordtype">char</span> *var) {
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (ns &gt; nio-1) {
<a name="l00145"></a>00145         <a class="code" href="group__egspp__main.html#ga4454fdf3403e87c098cd55f60dedbe56" title="Always use this function for reporting fatal errors.">egsFatal</a>(<span class="stringliteral">&quot;Mortran variable is not long enough to hold %s\n&quot;</span>,source);
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147     <span class="keywordtype">int</span> j;
<a name="l00148"></a>00148     <span class="keywordflow">for</span> (j=0; j&lt;ns; j++) {
<a name="l00149"></a>00149         var[j] = source[j];
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151     var[ns] = 0;
<a name="l00152"></a>00152     <span class="keywordflow">for</span> (j=ns+1; j&lt;nio; j++) {
<a name="l00153"></a>00153         var[j] = <span class="charliteral">&#39; &#39;</span>;
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="keyword">static</span> EGS_LOCAL <span class="keywordtype">char</span> __write_buf[8192];
<a name="l00158"></a>00158 <span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> F77_OBJ_(egs_write_string,EGS_WRITE_STRING)(<span class="keywordtype">int</span> *,
<a name="l00159"></a>00159         <span class="keyword">const</span> <span class="keywordtype">char</span> *,int);
<a name="l00160"></a>00160 <span class="keywordtype">void</span> EGS_LOCAL __write_to_fortran_file(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ...) {
<a name="l00161"></a>00161     va_list ap;
<a name="l00162"></a>00162     va_start(ap, msg);
<a name="l00163"></a>00163     vsprintf(__write_buf,msg,ap);
<a name="l00164"></a>00164     va_end(ap);
<a name="l00165"></a>00165     <span class="keywordtype">int</span> ounit=<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;i_log;
<a name="l00166"></a>00166     F77_OBJ_(egs_write_string,EGS_WRITE_STRING)(&amp;ounit,__write_buf,
<a name="l00167"></a>00167             strlen(__write_buf));
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 <span class="keywordtype">void</span> EGS_LOCAL __write_to_fortran_file_and_exit(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ...) {
<a name="l00170"></a>00170     va_list ap;
<a name="l00171"></a>00171     va_start(ap, msg);
<a name="l00172"></a>00172     vsprintf(__write_buf,msg,ap);
<a name="l00173"></a>00173     va_end(ap);
<a name="l00174"></a>00174     <span class="keywordtype">int</span> ounit=<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;i_log;
<a name="l00175"></a>00175     F77_OBJ_(egs_write_string,EGS_WRITE_STRING)(&amp;ounit,__write_buf,
<a name="l00176"></a>00176             strlen(__write_buf));
<a name="l00177"></a>00177     exit(1);
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keyword">extern</span> __extc__  <span class="keywordtype">void</span> F77_OBJ_(egs_set_defaults,EGS_SET_DEFAULTS)();
<a name="l00181"></a>00181 <span class="keyword">extern</span> __extc__  <span class="keywordtype">void</span> F77_OBJ_(egs_init1,EGS_INIT1)();
<a name="l00182"></a><a class="code" href="classEGS__AdvancedApplication.html#aaf2be335611fd068daf82928dd89cef0">00182</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#aaf2be335611fd068daf82928dd89cef0" title="Initialize the EGSnrc mortran back-end.">EGS_AdvancedApplication::initEGSnrcBackEnd</a>() {
<a name="l00183"></a>00183     F77_OBJ_(egs_set_defaults,EGS_SET_DEFAULTS)();
<a name="l00184"></a>00184     __egs_iovar(64,app_name.size(),app_name.c_str(),<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;user_code);
<a name="l00185"></a>00185     __egs_iovar(128,hen_house.size(),hen_house.c_str(),<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;hen_house);
<a name="l00186"></a>00186     __egs_iovar(128,egs_home.size(),egs_home.c_str(),<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;egs_home);
<a name="l00187"></a>00187     __egs_iovar(256,input_file.size(),input_file.c_str(),<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;input_file);
<a name="l00188"></a>00188     __egs_iovar(256,final_output_file.size(),final_output_file.c_str(),
<a name="l00189"></a>00189                 <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;output_file);
<a name="l00190"></a>00190     __egs_iovar(256,pegs_file.size(),pegs_file.c_str(),<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;pegs_file);
<a name="l00191"></a>00191     <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;i_parallel = i_parallel;
<a name="l00192"></a>00192     <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;n_parallel = n_parallel;
<a name="l00193"></a>00193     <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;is_pegsless = is_pegsless;
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (run) {
<a name="l00195"></a>00195         <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;n_chunk = run-&gt;getNchunk();
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197     <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;is_batch = (int) batch_run;
<a name="l00198"></a>00198     F77_OBJ_(egs_init1,EGS_INIT1)();
<a name="l00199"></a>00199     <span class="comment">/*</span>
<a name="l00200"></a>00200 <span class="comment">    if( batch_run ) {</span>
<a name="l00201"></a>00201 <span class="comment">        egsSetInfoFunction(Information,__write_to_fortran_file);</span>
<a name="l00202"></a>00202 <span class="comment">        egsSetInfoFunction(Warning,__write_to_fortran_file);</span>
<a name="l00203"></a>00203 <span class="comment">        egsSetInfoFunction(Fatal,__write_to_fortran_file_and_exit);</span>
<a name="l00204"></a>00204 <span class="comment">    }</span>
<a name="l00205"></a>00205 <span class="comment">    */</span>
<a name="l00206"></a>00206     io_flag = 1;
<a name="l00207"></a>00207     <span class="keywordflow">return</span> 0;
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="comment">/* The following 2 functions were used in an attempt to redirect</span>
<a name="l00211"></a>00211 <span class="comment">   all fortran I/O to use egsInformationn a degsWarning.</span>
<a name="l00212"></a>00212 <span class="comment">   Unfortunately, there were segmentation violations in the</span>
<a name="l00213"></a>00213 <span class="comment">   fortran I/O functions that I don&#39;t understand.</span>
<a name="l00214"></a>00214 <span class="comment"></span>
<a name="l00215"></a>00215 <span class="comment">extern __extc__  void F77_OBJ_(egs_info_output,EGS_INFO_OUTPUT)</span>
<a name="l00216"></a>00216 <span class="comment">    (char *msg, int len) {</span>
<a name="l00217"></a>00217 <span class="comment">    int j; for(j=len-1; j&gt;=0; j--) if( !isspace(msg[j]) ) break;</span>
<a name="l00218"></a>00218 <span class="comment">    if( j&lt;len-1 ) ++j;</span>
<a name="l00219"></a>00219 <span class="comment">    char c = msg[j]; msg[j] = 0;</span>
<a name="l00220"></a>00220 <span class="comment">    egsInformation(&quot;%s\n&quot;,msg);</span>
<a name="l00221"></a>00221 <span class="comment">    msg[j] = c;</span>
<a name="l00222"></a>00222 <span class="comment">}</span>
<a name="l00223"></a>00223 <span class="comment"></span>
<a name="l00224"></a>00224 <span class="comment">extern __extc__  void F77_OBJ_(egs_warning_output,EGS_WARNING_OUTPUT)</span>
<a name="l00225"></a>00225 <span class="comment">    (char *msg, int len) {</span>
<a name="l00226"></a>00226 <span class="comment">    int j; for(j=len-1; j&gt;=0; j--) if( !isspace(msg[j]) ) break;</span>
<a name="l00227"></a>00227 <span class="comment">    if( j&lt;len-1 ) ++j;</span>
<a name="l00228"></a>00228 <span class="comment">    char c = msg[j]; msg[j] = 0;</span>
<a name="l00229"></a>00229 <span class="comment">    egsWarning(&quot;%s\n&quot;,msg);</span>
<a name="l00230"></a>00230 <span class="comment">    msg[j] = c;</span>
<a name="l00231"></a>00231 <span class="comment">}</span>
<a name="l00232"></a>00232 <span class="comment">*/</span>
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="preprocessor">#ifndef SKIP_DOXYGEN</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span>
<a name="l00242"></a>00242 <span class="keyword">class </span>EGS_LOCAL EGS_TransportProperty {
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="keywordtype">string</span> name;
<a name="l00245"></a>00245     vector&lt;string&gt; options;
<a name="l00246"></a>00246     vector&lt;string&gt; *str_v;
<a name="l00247"></a>00247     vector&lt;EGS_Float&gt; *f_v;
<a name="l00248"></a>00248     <span class="keywordtype">string</span>     charinp;
<a name="l00249"></a>00249     <span class="keywordtype">int</span>        type;
<a name="l00250"></a>00250     EGS_I32   *int_input;
<a name="l00251"></a>00251     EGS_Float *float_input;
<a name="l00252"></a>00252     <span class="keywordtype">int</span>        len,nitem;
<a name="l00253"></a>00253     <span class="keywordtype">char</span>      *char_input;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="keyword">public</span>:
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="comment">/* Integer input type = 0 */</span>
<a name="l00258"></a>00258     EGS_TransportProperty(<span class="keyword">const</span> <span class="keywordtype">char</span> *Name, EGS_I32 *val) :
<a name="l00259"></a>00259         name(Name), type(0), int_input(val) {};
<a name="l00260"></a>00260     <span class="comment">/* Real input type = 1 */</span>
<a name="l00261"></a>00261     EGS_TransportProperty(<span class="keyword">const</span> <span class="keywordtype">char</span> *Name, EGS_Float *val) :
<a name="l00262"></a>00262         name(Name), type(1), float_input(val) {};
<a name="l00263"></a>00263     <span class="comment">/* Character string input type = 3 */</span>
<a name="l00264"></a>00264     EGS_TransportProperty(<span class="keyword">const</span> <span class="keywordtype">char</span> *Name, <span class="keywordtype">int</span> L, <span class="keywordtype">char</span> *val) :
<a name="l00265"></a>00265         name(Name), type(3), char_input(val), len(L) {};
<a name="l00266"></a>00266     <span class="comment">/* Character string array input type = 4 */</span>
<a name="l00267"></a>00267     EGS_TransportProperty(<span class="keyword">const</span> <span class="keywordtype">char</span> *Name,<span class="keywordtype">int</span> L,<span class="keywordtype">int</span> N,vector&lt;string&gt; *str):
<a name="l00268"></a>00268         name(Name), type(4), str_v(str), len(L), nitem(N) {};
<a name="l00269"></a>00269     <span class="comment">/* Real array input type = 5 */</span>
<a name="l00270"></a>00270     EGS_TransportProperty(<span class="keyword">const</span> <span class="keywordtype">char</span> *Name,<span class="keywordtype">int</span> N,vector&lt;EGS_Float&gt; *f):
<a name="l00271"></a>00271         name(Name), type(5), f_v(f), nitem(N) {};
<a name="l00272"></a>00272     <span class="comment">/* Integer input with allowed values =&gt; type = 2 */</span>
<a name="l00273"></a>00273     <span class="keywordtype">void</span> addOption(<span class="keyword">const</span> <span class="keywordtype">char</span> *opt) {
<a name="l00274"></a>00274         options.push_back(opt);
<a name="l00275"></a>00275         type = 2;
<a name="l00276"></a>00276     };
<a name="l00277"></a>00277     <span class="keywordtype">void</span> getInput(<a class="code" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> *input) {
<a name="l00278"></a>00278         <span class="keywordflow">if</span> (type == 1) {
<a name="l00279"></a>00279             EGS_Float aux;
<a name="l00280"></a>00280             <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(name,aux);
<a name="l00281"></a>00281             <span class="keywordflow">if</span> (!err) {
<a name="l00282"></a>00282                 *float_input = aux;
<a name="l00283"></a>00283             }
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 0) {
<a name="l00286"></a>00286             EGS_I32 aux;
<a name="l00287"></a>00287             <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(name,aux);
<a name="l00288"></a>00288             <span class="keywordflow">if</span> (!err) {
<a name="l00289"></a>00289                 *int_input = aux;
<a name="l00290"></a>00290             }
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 3) {
<a name="l00293"></a>00293             <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(name,charinp);
<a name="l00294"></a>00294             <span class="keywordflow">if</span> (!err) {
<a name="l00295"></a>00295                 <span class="keywordtype">int</span> l = charinp.size();
<a name="l00296"></a>00296                 <span class="keywordflow">if</span> (l &gt; len) {
<a name="l00297"></a>00297                     l = len;
<a name="l00298"></a>00298                 }
<a name="l00299"></a>00299                 <span class="keywordtype">int</span> j;
<a name="l00300"></a>00300                 <span class="keywordflow">for</span> (j=0; j&lt;l; j++) {
<a name="l00301"></a>00301                     char_input[j] = charinp[j];
<a name="l00302"></a>00302                 }
<a name="l00303"></a>00303                 <span class="keywordflow">for</span> (j=l; j&lt;len; j++) {
<a name="l00304"></a>00304                     char_input[j] = <span class="charliteral">&#39; &#39;</span>;
<a name="l00305"></a>00305                 }
<a name="l00306"></a>00306             }
<a name="l00307"></a>00307             <span class="keywordflow">else</span> {
<a name="l00308"></a>00308                 charinp = string(char_input).substr(0,len);
<a name="l00309"></a>00309             }
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 4) {
<a name="l00312"></a>00312             <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(name,*str_v);
<a name="l00313"></a>00313             <span class="keywordflow">if</span> (!err) {
<a name="l00314"></a>00314                 vector&lt;string&gt; str = *str_v;
<a name="l00315"></a>00315                 str_v-&gt;clear();
<a name="l00316"></a>00316                 <span class="keywordtype">int</span> number = str.size();
<a name="l00317"></a>00317                 <span class="keywordflow">if</span> (number&gt;nitem) {
<a name="l00318"></a>00318                     str.erase(str.begin()+nitem,str.end());
<a name="l00319"></a>00319                     number=nitem;
<a name="l00320"></a>00320                 }
<a name="l00321"></a>00321                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;number; i++) {
<a name="l00322"></a>00322                     <span class="keywordflow">if</span> (str[i].size()&gt;len) {
<a name="l00323"></a>00323                         str[i] = str[i].substr(0,len);
<a name="l00324"></a>00324                     }
<a name="l00325"></a>00325                 }
<a name="l00326"></a>00326                 *str_v = str;
<a name="l00327"></a>00327             }
<a name="l00328"></a>00328         }
<a name="l00329"></a>00329         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 5) {
<a name="l00330"></a>00330             <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(name,*f_v);
<a name="l00331"></a>00331             <span class="keywordflow">if</span> (!err) {
<a name="l00332"></a>00332                 vector&lt;EGS_Float&gt; fv = *f_v;
<a name="l00333"></a>00333                 f_v-&gt;clear();
<a name="l00334"></a>00334                 <span class="keywordtype">int</span> number = fv.size();
<a name="l00335"></a>00335                 <span class="keywordflow">if</span> (number&gt;nitem) {
<a name="l00336"></a>00336                     fv.erase(fv.begin()+nitem,fv.end());
<a name="l00337"></a>00337                     number=nitem;
<a name="l00338"></a>00338                 }
<a name="l00339"></a>00339                 *f_v = fv;
<a name="l00340"></a>00340             }
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342         <span class="keywordflow">else</span> {
<a name="l00343"></a>00343             <span class="keywordtype">bool</span> is_ok;
<a name="l00344"></a>00344             EGS_I32 iaux = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(name,options,0,&amp;is_ok);
<a name="l00345"></a>00345             <span class="keywordflow">if</span> (is_ok) {
<a name="l00346"></a>00346                 *int_input = iaux;
<a name="l00347"></a>00347             }
<a name="l00348"></a>00348             <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;Property %s: %d\n&quot;</span>,name.c_str(),*int_input);
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350     };
<a name="l00351"></a>00351     <span class="keywordtype">void</span> info(<span class="keywordtype">int</span> nc) {
<a name="l00352"></a>00352         <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;%s&quot;</span>,name.c_str());
<a name="l00353"></a>00353         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=name.size(); j&lt;nc; j++) {
<a name="l00354"></a>00354             <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot; &quot;</span>);
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356         <span class="keywordflow">if</span> (type == 0) {
<a name="l00357"></a>00357             <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;%d\n&quot;</span>,*int_input);
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 1) {
<a name="l00360"></a>00360             <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;%g\n&quot;</span>,*float_input);
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 3) {
<a name="l00363"></a>00363             <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;%s\n&quot;</span>,(<span class="keywordtype">string</span>(char_input).substr(0,len)).c_str());
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 5) {
<a name="l00366"></a>00366             <span class="keywordflow">for</span> (vector&lt;EGS_Float&gt;::iterator it = f_v-&gt;begin() ; it != f_v-&gt;end(); ++it) {
<a name="l00367"></a>00367                 <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;%g &quot;</span>,*it);
<a name="l00368"></a>00368             }
<a name="l00369"></a>00369             <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00370"></a>00370         }
<a name="l00371"></a>00371         <span class="keywordflow">else</span> {
<a name="l00372"></a>00372             <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;%s\n&quot;</span>,options[*int_input].c_str());
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374     };
<a name="l00375"></a>00375     <span class="keywordtype">int</span> size() {
<a name="l00376"></a>00376         <span class="keywordflow">if</span> (type == 1) {
<a name="l00377"></a>00377             <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(EGS_Float);
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 3) {
<a name="l00380"></a>00380             <span class="keywordflow">return</span> len;
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 4) {
<a name="l00383"></a>00383             <span class="keywordflow">return</span> nitem;
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 5) {
<a name="l00386"></a>00386             <span class="keywordflow">return</span> f_v-&gt;size();
<a name="l00387"></a>00387         }
<a name="l00388"></a>00388         <span class="keywordflow">else</span> {
<a name="l00389"></a>00389             <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(EGS_I32);
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391     };
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 };
<a name="l00394"></a>00394 <span class="preprocessor">#endif</span>
<a name="l00395"></a>00395 <span class="preprocessor"></span>
<a name="l00396"></a><a class="code" href="classEGS__AdvancedApplication.html#ad7e0a85a02fb0fff67e250d26bd700d9">00396</a> <a class="code" href="classEGS__AdvancedApplication.html#ad7e0a85a02fb0fff67e250d26bd700d9" title="Constructor.">EGS_AdvancedApplication::EGS_AdvancedApplication</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) :
<a name="l00397"></a>00397     <a class="code" href="classEGS__Application.html" title="Base class for advanced EGSnrc C++ applications.">EGS_Application</a>(argc,argv), n_rng_buffer(0), final_job(false), nmed(0), io_flag(0) { }
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="classEGS__AdvancedApplication.html#a3ead32080a375534a6f1487528949fc4">00399</a> <a class="code" href="classEGS__AdvancedApplication.html#a3ead32080a375534a6f1487528949fc4" title="Destructor.">EGS_AdvancedApplication::~EGS_AdvancedApplication</a>() {
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (<a class="code" href="classEGS__AdvancedApplication.html#acaf275fb4a58347356e836a1b9122d0e" title="Size of the RNG buffer.">n_rng_buffer</a> &gt; 0) {
<a name="l00401"></a>00401         <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a465e2a5ddb90f3b99b4949ca80cd531f" title="RNG buffer.">rng_buffer</a>;
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="classEGS__AdvancedApplication.html#af70c20ea7cb0bf1997f3761e79b0c6ca">00405</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#af70c20ea7cb0bf1997f3761e79b0c6ca" title="Describe the simulation.">EGS_AdvancedApplication::describeSimulation</a>() {
<a name="l00406"></a>00406     <a class="code" href="classEGS__AdvancedApplication.html#af70c20ea7cb0bf1997f3761e79b0c6ca" title="Describe the simulation.">EGS_Application::describeSimulation</a>();
<a name="l00407"></a>00407     <span class="keywordflow">if</span> (<a class="code" href="classEGS__AdvancedApplication.html#a7235c49cea1062da92cd0b09e192cf48" title="Is this the final job of a parallel run ?">final_job</a>) {
<a name="l00408"></a>00408         <a class="code" href="classEGS__AdvancedApplication.html#ad6f36754d68880be14de330b7533b54a" title="Helper function used in initCrossSections() and describeSimulation().">helpInit</a>(0,<span class="keyword">false</span>);
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="classEGS__AdvancedApplication.html#a0e66bc7f3e7d1470bd25ae22cb31f4d0">00412</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#a0e66bc7f3e7d1470bd25ae22cb31f4d0" title="Initialize the run-time cross section data.">EGS_AdvancedApplication::initCrossSections</a>() {
<a name="l00413"></a>00413     <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;In initCrossSections(): spin effects = %d\n&quot;</span>,
<a name="l00414"></a>00414                <a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a97426b3d3d08fdff5ef6959709f0b87c">spin_effects</a>);
<a name="l00415"></a>00415     <a class="code" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> *transportp = input-&gt;<a class="code" href="classEGS__Input.html#a97596e3136e78553a27bd78fa0992d19" title="Same as the previous function but now ownership remains with the EGS_Input object.">getInputItem</a>(<span class="stringliteral">&quot;MC transport parameter&quot;</span>);
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (!transportp) {
<a name="l00417"></a>00417         transportp = input-&gt;<a class="code" href="classEGS__Input.html#a97596e3136e78553a27bd78fa0992d19" title="Same as the previous function but now ownership remains with the EGS_Input object.">getInputItem</a>(<span class="stringliteral">&quot;transport parameter&quot;</span>);
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419     <span class="keywordflow">return</span> <a class="code" href="classEGS__AdvancedApplication.html#ad6f36754d68880be14de330b7533b54a" title="Helper function used in initCrossSections() and describeSimulation().">helpInit</a>(transportp,<span class="keyword">true</span>);
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> F77_OBJ_(set_elastic_parameter,SET_ELASTIC_PARAMETER)();
<a name="l00423"></a>00423 
<a name="l00424"></a><a class="code" href="classEGS__AdvancedApplication.html#ad6f36754d68880be14de330b7533b54a">00424</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#ad6f36754d68880be14de330b7533b54a" title="Helper function used in initCrossSections() and describeSimulation().">EGS_AdvancedApplication::helpInit</a>(<a class="code" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> *transportp, <span class="keywordtype">bool</span> do_hatch) {
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (!<a class="code" href="classEGS__Application.html#a8233242b9b4f891ab2b1765c80ec00eb" title="the geometry of this simulation">geometry</a>) {
<a name="l00426"></a>00426         <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;initCrossSections(): no geometry?\n&quot;</span>);
<a name="l00427"></a>00427         <span class="keywordflow">return</span> 1;
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429     <a class="code" href="classEGS__BaseGeometry.html#a7c77da863214e5fed1d7a74e2a3753bc" title="Set the currently active geometry list.">EGS_BaseGeometry::setActiveGeometryList</a>(<a class="code" href="classEGS__Application.html#a9938e06c7b8f7ba3b2ff89c77db46a62" title="the index of this application.">app_index</a>);
<a name="l00430"></a>00430     <span class="keywordtype">int</span> nmed_new = <a class="code" href="classEGS__BaseGeometry.html#a1079ab127c8a177b49c4c7abe40d4032" title="Get the number of media registered so far by all geometries.">EGS_BaseGeometry::nMedia</a>(), j;
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (nmed_new &lt; 1) {
<a name="l00432"></a>00432         <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;initCrossSections(): no media in this geometry?\n&quot;</span>);
<a name="l00433"></a>00433         <span class="keywordflow">return</span> 2;
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435     <span class="keywordtype">int</span> nmed_old = <a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>;
<a name="l00436"></a>00436     <a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a> = nmed_new;
<a name="l00437"></a>00437     <span class="keywordtype">int</span> *ind = <span class="keyword">new</span> <span class="keywordtype">int</span> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00438"></a>00438     <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>; j++) {
<a name="l00439"></a>00439         <span class="keyword">const</span> <span class="keywordtype">char</span> *medname = <a class="code" href="classEGS__Application.html#a8233242b9b4f891ab2b1765c80ec00eb" title="the geometry of this simulation">geometry</a>-&gt;<a class="code" href="classEGS__BaseGeometry.html#ae4e34d2db932d722bde692cc5f584eb3" title="Get the name of medium with index ind.">getMediumName</a>(j);
<a name="l00440"></a>00440         <span class="keywordtype">int</span> len = strlen(medname);
<a name="l00441"></a>00441         ind[j] = <a class="code" href="egs__interface2_8h.html#a5f0449e13f12dbf46d0bf4982271c6fd" title="Add a medium to the list of media.">egsAddMedium</a>(medname, len);
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     vector&lt;string&gt; ff_media, ff_names;
<a name="l00445"></a>00445     <span class="keywordtype">string</span> eii_xsect;
<a name="l00446"></a>00446     vector&lt;EGS_Float&gt; efield_v, bfield_v;
<a name="l00447"></a>00447     <span class="comment">//</span>
<a name="l00448"></a>00448     <span class="comment">// The Intel compiler uses -1 for .true. =&gt; all logical</span>
<a name="l00449"></a>00449     <span class="comment">// variables don&#39;t work!</span>
<a name="l00450"></a>00450     <span class="comment">// This is a fix for this</span>
<a name="l00451"></a>00451     <span class="comment">//</span>
<a name="l00452"></a>00452     <span class="keywordflow">if</span> (<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a97426b3d3d08fdff5ef6959709f0b87c">spin_effects</a> != 0) {
<a name="l00453"></a>00453         <a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a97426b3d3d08fdff5ef6959709f0b87c">spin_effects</a>=1;
<a name="l00454"></a>00454     }
<a name="l00455"></a>00455     <span class="comment">//if( the_xoptions-&gt;exact_bca != 0 ) the_xoptions-&gt;exact_bca=1;</span>
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="comment">//</span>
<a name="l00458"></a>00458     <span class="comment">// See if there are transport parameters set in the input file.</span>
<a name="l00459"></a>00459     <span class="comment">//</span>
<a name="l00460"></a>00460     EGS_TransportProperty efield(<span class="stringliteral">&quot;Electric Field&quot;</span>,3,&amp;efield_v);
<a name="l00461"></a>00461     EGS_TransportProperty bfield(<span class="stringliteral">&quot;Magnetic Field&quot;</span>,3,&amp;bfield_v);
<a name="l00462"></a>00462     EGS_TransportProperty estepem(<span class="stringliteral">&quot;EM ESTEPE&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a120dec334c067bbe0d9a6f89b3bb8c44" title="The address of the mortran EMF-INPUTS common block as a pointer to a C-structure of type EGS_emfInput...">the_emf</a>-&gt;EMLMTIN);
<a name="l00463"></a>00463     EGS_TransportProperty ecut(<span class="stringliteral">&quot;Global Ecut&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a0d66145761089ca80198dfe68f21a781" title="The address of the morrtan BOUNDS common block as a pointer to a C-structure of type EGS_Bounds...">the_bounds</a>-&gt;<a class="code" href="structEGS__Bounds.html#a8090563f9665a1fcce5a500ba669aaf2">ecut</a>);
<a name="l00464"></a>00464     EGS_TransportProperty pcut(<span class="stringliteral">&quot;Global Pcut&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a0d66145761089ca80198dfe68f21a781" title="The address of the morrtan BOUNDS common block as a pointer to a C-structure of type EGS_Bounds...">the_bounds</a>-&gt;<a class="code" href="structEGS__Bounds.html#a08a90ddf138358bcef8b98c82e38c66b">pcut</a>);
<a name="l00465"></a>00465     EGS_TransportProperty smax(<span class="stringliteral">&quot;Global Smax&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#a579620c18e423e34364639903e5f3f5d">smaxir</a>);
<a name="l00466"></a>00466     EGS_TransportProperty estep(<span class="stringliteral">&quot;ESTEPE&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#a8c12f126a0ec77bc70d3df3a8b3e78b9">estepe</a>);
<a name="l00467"></a>00467     EGS_TransportProperty ximax(<span class="stringliteral">&quot;Ximax&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#a99d8d74aba34e870a2986758068b47b5">ximax</a>);
<a name="l00468"></a>00468     EGS_TransportProperty skind(<span class="stringliteral">&quot;Skin depth for BCA&quot;</span>,
<a name="l00469"></a>00469                                 &amp;<a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#abd4e70dc4920439649ae701383ed17d6">skindepth_for_bca</a>);
<a name="l00470"></a>00470     EGS_TransportProperty pxsec(<span class="stringliteral">&quot;Photon cross sections&quot;</span>,16,<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#a0ce6f7337971b982153417cdd787adfc">pxsec</a>);
<a name="l00471"></a>00471     EGS_TransportProperty pxsec_out(<span class="stringliteral">&quot;Photon cross-sections output&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;xsec_out);
<a name="l00472"></a>00472     pxsec_out.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00473"></a>00473     pxsec_out.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00474"></a>00474     EGS_TransportProperty cxsec(<span class="stringliteral">&quot;Compton cross sections&quot;</span>,16,<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#aab3e1a57cdb2097f6af1fdba6b423391">compxsec</a>);
<a name="l00475"></a>00475     EGS_TransportProperty bc(<span class="stringliteral">&quot;Bound Compton scattering&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a94fcbb1f5011ecf8e934643f48382def">ibcmp</a>);
<a name="l00476"></a>00476     bc.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00477"></a>00477     bc.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00478"></a>00478     bc.addOption(<span class="stringliteral">&quot;Simple&quot;</span>);
<a name="l00479"></a>00479     bc.addOption(<span class="stringliteral">&quot;norej&quot;</span>);
<a name="l00480"></a>00480     EGS_TransportProperty radc(<span class="stringliteral">&quot;Radiative Compton corrections&quot;</span>,
<a name="l00481"></a>00481                                &amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#abafcd223e518dc571c52473d41e5f23b">radc_flag</a>);
<a name="l00482"></a>00482     radc.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00483"></a>00483     radc.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00484"></a>00484     <span class="comment">/* Photonuclear input parameters */</span>
<a name="l00485"></a>00485     EGS_TransportProperty photonucxsec(<span class="stringliteral">&quot;Photonuclear cross sections&quot;</span>,16,<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#a200777cfce616524623ace0d3ddd2f03">photonucxsec</a>);
<a name="l00486"></a>00486     EGS_TransportProperty photonuc(<span class="stringliteral">&quot;Photonuclear attenuation&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a9b01a2d8e8d0b16b1cdac15b97f65219">iphotonuc</a>);
<a name="l00487"></a>00487     photonuc.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00488"></a>00488     photonuc.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     EGS_TransportProperty rayl(<span class="stringliteral">&quot;Rayleigh scattering&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a7715f3c59f7282ac64bd00473099db58">iraylr</a>);
<a name="l00491"></a>00491     rayl.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00492"></a>00492     rayl.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00493"></a>00493     rayl.addOption(<span class="stringliteral">&quot;custom&quot;</span>);
<a name="l00494"></a>00494     EGS_TransportProperty ff_med(<span class="stringliteral">&quot;ff media names&quot;</span>,24,MXMED,&amp;ff_media);
<a name="l00495"></a>00495     EGS_TransportProperty ff_files(<span class="stringliteral">&quot;ff file names&quot;</span>,128,MXMED, &amp;ff_names);
<a name="l00496"></a>00496     EGS_TransportProperty relax(<span class="stringliteral">&quot;Atomic relaxations&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a4eb42b4c1180255eba68cbfbd1cf4ea5">iedgfl</a>);
<a name="l00497"></a>00497     relax.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00498"></a>00498     relax.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00499"></a>00499     EGS_TransportProperty iphter(<span class="stringliteral">&quot;Photoelectron angular sampling&quot;</span>,
<a name="l00500"></a>00500                                  &amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a1d3327d0f00b08e2fdc33d2c769071a3">iphter</a>);
<a name="l00501"></a>00501     iphter.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00502"></a>00502     iphter.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00503"></a>00503     EGS_TransportProperty spin(<span class="stringliteral">&quot;Spin effects&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a97426b3d3d08fdff5ef6959709f0b87c">spin_effects</a>);
<a name="l00504"></a>00504     spin.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00505"></a>00505     spin.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00506"></a>00506     EGS_TransportProperty trip(<span class="stringliteral">&quot;Triplet production&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#ae8cb7b35da48ab72561819adbe411f12">itriplet</a>);
<a name="l00507"></a>00507     trip.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00508"></a>00508     trip.addOption(<span class="stringliteral">&quot;On&quot;</span>);
<a name="l00509"></a>00509     EGS_TransportProperty eii(<span class="stringliteral">&quot;Electron Impact Ionization&quot;</span>,16,<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#a181ff35de96cca8d89620e21754156af">eiixsec</a>);
<a name="l00510"></a>00510     EGS_TransportProperty brem(<span class="stringliteral">&quot;Brems cross sections&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a1f16fe67aabf2fdbda6e755fa1634e9a">ibr_nist</a>);
<a name="l00511"></a>00511     brem.addOption(<span class="stringliteral">&quot;BH&quot;</span>);
<a name="l00512"></a>00512     brem.addOption(<span class="stringliteral">&quot;NIST&quot;</span>);
<a name="l00513"></a>00513     brem.addOption(<span class="stringliteral">&quot;NRC&quot;</span>);
<a name="l00514"></a>00514     EGS_TransportProperty bang(<span class="stringliteral">&quot;Brems angular sampling&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a15ae60d26d4a8ae40cfd749e32d14933">ibrdst</a>);
<a name="l00515"></a>00515     bang.addOption(<span class="stringliteral">&quot;Simple&quot;</span>);
<a name="l00516"></a>00516     bang.addOption(<span class="stringliteral">&quot;KM&quot;</span>);
<a name="l00517"></a>00517     EGS_TransportProperty pair(<span class="stringliteral">&quot;Pair cross sections&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a6585eaaabfb69c5a5d120033d7caea3c">pair_nrc</a>);
<a name="l00518"></a>00518     pair.addOption(<span class="stringliteral">&quot;BH&quot;</span>);
<a name="l00519"></a>00519     pair.addOption(<span class="stringliteral">&quot;NRC&quot;</span>);
<a name="l00520"></a>00520     EGS_TransportProperty pang(<span class="stringliteral">&quot;Pair angular sampling&quot;</span>,&amp;<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a0d4b98d95d75611e73ad7218cf7017d6">iprdst</a>);
<a name="l00521"></a>00521     pang.addOption(<span class="stringliteral">&quot;Off&quot;</span>);
<a name="l00522"></a>00522     pang.addOption(<span class="stringliteral">&quot;Simple&quot;</span>);
<a name="l00523"></a>00523     pang.addOption(<span class="stringliteral">&quot;KM&quot;</span>);
<a name="l00524"></a>00524     pang.addOption(<span class="stringliteral">&quot;Uniform&quot;</span>);
<a name="l00525"></a>00525     pang.addOption(<span class="stringliteral">&quot;Blend&quot;</span>);
<a name="l00526"></a>00526     EGS_TransportProperty tran(<span class="stringliteral">&quot;Electron-step algorithm&quot;</span>,
<a name="l00527"></a>00527                                &amp;<a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#ae993e90e799a4dc6f223ce99754305ba">transport_algorithm</a>);
<a name="l00528"></a>00528     tran.addOption(<span class="stringliteral">&quot;EGSnrc&quot;</span>);
<a name="l00529"></a>00529     tran.addOption(<span class="stringliteral">&quot;PRESTA-I&quot;</span>);
<a name="l00530"></a>00530     tran.addOption(<span class="stringliteral">&quot;PRESTA-II&quot;</span>);
<a name="l00531"></a>00531     tran.addOption(<span class="stringliteral">&quot;default&quot;</span>);
<a name="l00532"></a>00532     EGS_TransportProperty bca(<span class="stringliteral">&quot;Boundary crossing algorithm&quot;</span>,
<a name="l00533"></a>00533                               &amp;<a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#acbbdcda9e2f9619b5a303cb3aee7a04c">bca_algorithm</a>);
<a name="l00534"></a>00534     bca.addOption(<span class="stringliteral">&quot;Exact&quot;</span>);
<a name="l00535"></a>00535     bca.addOption(<span class="stringliteral">&quot;PRESTA-I&quot;</span>);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (transportp) {
<a name="l00538"></a>00538         efield.getInput(transportp);
<a name="l00539"></a>00539         bfield.getInput(transportp);
<a name="l00540"></a>00540         estepem.getInput(transportp);
<a name="l00541"></a>00541         ecut.getInput(transportp);
<a name="l00542"></a>00542         pcut.getInput(transportp);
<a name="l00543"></a>00543         smax.getInput(transportp);
<a name="l00544"></a>00544         <a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#ab3718eaedd90fc2237c389a42e425cbe">smax_new</a> = <a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#a579620c18e423e34364639903e5f3f5d">smaxir</a>;
<a name="l00545"></a>00545         estep.getInput(transportp);
<a name="l00546"></a>00546         ximax.getInput(transportp);
<a name="l00547"></a>00547         skind.getInput(transportp);
<a name="l00548"></a>00548         pxsec.getInput(transportp);
<a name="l00549"></a>00549         pxsec_out.getInput(transportp);
<a name="l00550"></a>00550         cxsec.getInput(transportp);
<a name="l00551"></a>00551         photonucxsec.getInput(transportp);
<a name="l00552"></a>00552         photonuc.getInput(transportp);
<a name="l00553"></a>00553         bc.getInput(transportp);
<a name="l00554"></a>00554         radc.getInput(transportp);
<a name="l00555"></a>00555         rayl.getInput(transportp);
<a name="l00556"></a>00556         <span class="keywordflow">if</span> (<a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a7715f3c59f7282ac64bd00473099db58">iraylr</a>&gt;1) {
<a name="l00557"></a>00557             ff_med.getInput(transportp);
<a name="l00558"></a>00558             ff_files.getInput(transportp);
<a name="l00559"></a>00559             <a class="code" href="classEGS__AdvancedApplication.html#a9e7bb40054e0b06772d5ba2aecebe3f0" title="Custom Rayleigh data setup.">setRayleighData</a>(ff_media,ff_names);
<a name="l00560"></a>00560         }
<a name="l00561"></a>00561         relax.getInput(transportp);
<a name="l00562"></a>00562         iphter.getInput(transportp);
<a name="l00563"></a>00563         spin.getInput(transportp);
<a name="l00564"></a>00564         trip.getInput(transportp);
<a name="l00565"></a>00565         eii.getInput(transportp);
<a name="l00566"></a>00566         <a class="code" href="classEGS__AdvancedApplication.html#a5353a5522bbe6f2cafa947f7903ae559" title="Set EII flag and xsection file name.">setEIIData</a>(eii.size());
<a name="l00567"></a>00567         brem.getInput(transportp);
<a name="l00568"></a>00568         bang.getInput(transportp);
<a name="l00569"></a>00569         pair.getInput(transportp);
<a name="l00570"></a>00570         pang.getInput(transportp);
<a name="l00571"></a>00571         tran.getInput(transportp);
<a name="l00572"></a>00572         <span class="keywordflow">if</span> (<a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#ae993e90e799a4dc6f223ce99754305ba">transport_algorithm</a> &gt; 1) {
<a name="l00573"></a>00573             <a class="code" href="egs__interface2_8h.html#a886bd801a5a0f7cd0e874222152dbde2" title="The address of the mortran Et_Control common block as a pointer to a C-structure of type EGS_EtContro...">the_etcontrol</a>-&gt;<a class="code" href="structEGS__EtControl.html#ae993e90e799a4dc6f223ce99754305ba">transport_algorithm</a> = 0;
<a name="l00574"></a>00574         }
<a name="l00575"></a>00575         bca.getInput(transportp);
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (do_hatch) {
<a name="l00579"></a>00579 
<a name="l00580"></a>00580         <a class="code" href="egs__interface2_8h.html#a1171ae5ccfe510184a60fa51c6bdc073" title="Initialize cross section data from a PEGS4 data file.">egsHatch</a>();
<a name="l00581"></a>00581         F77_OBJ_(set_elastic_parameter,SET_ELASTIC_PARAMETER)();
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         <a class="code" href="egs__interface2_8h.html#a0d66145761089ca80198dfe68f21a781" title="The address of the morrtan BOUNDS common block as a pointer to a C-structure of type EGS_Bounds...">the_bounds</a>-&gt;<a class="code" href="structEGS__Bounds.html#af5eda9927f7398678e3f1bb39d71b418">ecut_new</a> = <a class="code" href="egs__interface2_8h.html#a0d66145761089ca80198dfe68f21a781" title="The address of the morrtan BOUNDS common block as a pointer to a C-structure of type EGS_Bounds...">the_bounds</a>-&gt;<a class="code" href="structEGS__Bounds.html#a8090563f9665a1fcce5a500ba669aaf2">ecut</a>;
<a name="l00584"></a>00584         <a class="code" href="egs__interface2_8h.html#a0d66145761089ca80198dfe68f21a781" title="The address of the morrtan BOUNDS common block as a pointer to a C-structure of type EGS_Bounds...">the_bounds</a>-&gt;<a class="code" href="structEGS__Bounds.html#a01a1fa5004ca28e340aa6d12ea1e24c9">pcut_new</a> = <a class="code" href="egs__interface2_8h.html#a0d66145761089ca80198dfe68f21a781" title="The address of the morrtan BOUNDS common block as a pointer to a C-structure of type EGS_Bounds...">the_bounds</a>-&gt;<a class="code" href="structEGS__Bounds.html#a08a90ddf138358bcef8b98c82e38c66b">pcut</a>;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         <span class="keywordflow">if</span> (nmed_old &gt; 0) {
<a name="l00587"></a>00587             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a6798d306aa53b89d3a41ab14207c7391" title="electron stopping power interpolator">i_ededx</a>;
<a name="l00588"></a>00588             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#aae5f6e44f79bcdd85cfed94727c7d783" title="positron stopping power interpolator">i_pdedx</a>;
<a name="l00589"></a>00589             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a45711991e1c3aaf0af45339d7c318bc7" title="electron cross section interpolator">i_esig</a>;
<a name="l00590"></a>00590             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a629117cc2675f841e2d566566aee35c0" title="positron cross section interpolator">i_psig</a>;
<a name="l00591"></a>00591             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a87dab289c2209afc42af4d9c825517ec" title="electron branching interpolator">i_ebr1</a>;
<a name="l00592"></a>00592             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a4785c4feb0b889c7fc7f0d3a562a0655" title="positron branching 1 interpolator">i_pbr1</a>;
<a name="l00593"></a>00593             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#ab440420c3d2e428750ef944ad4b8329a" title="positron branching 2 interpolator">i_pbr2</a>;
<a name="l00594"></a>00594             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a84f5abc572b724d4d5830544cb2ea969" title="photon mean-free-path interpolator">i_gmfp</a>;
<a name="l00595"></a>00595             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#aef675679d949844efe71e5dc3a0393fd" title="photon branching 1 interpolator">i_gbr1</a>;
<a name="l00596"></a>00596             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a447eae1bc2b0add4ad91476dd4dcd426" title="photon branching 2 interpolator">i_gbr2</a>;
<a name="l00597"></a>00597             <span class="keyword">delete</span> [] <a class="code" href="classEGS__AdvancedApplication.html#a85092eb8cd8757b03db0026cb789e53a" title="photon Rayleigh interpolator">i_cohe</a>;
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599         <span class="keywordflow">if</span> (nmed &gt; 0) {
<a name="l00600"></a>00600             <a class="code" href="classEGS__AdvancedApplication.html#a6798d306aa53b89d3a41ab14207c7391" title="electron stopping power interpolator">i_ededx</a> = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00601"></a>00601             <a class="code" href="classEGS__AdvancedApplication.html#aae5f6e44f79bcdd85cfed94727c7d783" title="positron stopping power interpolator">i_pdedx</a> = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00602"></a>00602             <a class="code" href="classEGS__AdvancedApplication.html#a45711991e1c3aaf0af45339d7c318bc7" title="electron cross section interpolator">i_esig</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00603"></a>00603             <a class="code" href="classEGS__AdvancedApplication.html#a629117cc2675f841e2d566566aee35c0" title="positron cross section interpolator">i_psig</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00604"></a>00604             <a class="code" href="classEGS__AdvancedApplication.html#a87dab289c2209afc42af4d9c825517ec" title="electron branching interpolator">i_ebr1</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00605"></a>00605             <a class="code" href="classEGS__AdvancedApplication.html#a4785c4feb0b889c7fc7f0d3a562a0655" title="positron branching 1 interpolator">i_pbr1</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00606"></a>00606             <a class="code" href="classEGS__AdvancedApplication.html#ab440420c3d2e428750ef944ad4b8329a" title="positron branching 2 interpolator">i_pbr2</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00607"></a>00607             <a class="code" href="classEGS__AdvancedApplication.html#a84f5abc572b724d4d5830544cb2ea969" title="photon mean-free-path interpolator">i_gmfp</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00608"></a>00608             <a class="code" href="classEGS__AdvancedApplication.html#aef675679d949844efe71e5dc3a0393fd" title="photon branching 1 interpolator">i_gbr1</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00609"></a>00609             <a class="code" href="classEGS__AdvancedApplication.html#a447eae1bc2b0add4ad91476dd4dcd426" title="photon branching 2 interpolator">i_gbr2</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00610"></a>00610             <a class="code" href="classEGS__AdvancedApplication.html#a85092eb8cd8757b03db0026cb789e53a" title="photon Rayleigh interpolator">i_cohe</a>  = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00611"></a>00611             <a class="code" href="classEGS__AdvancedApplication.html#aad861bfa243e5dd1278a0906ebde1e7d" title="photonuclear interpolator">i_photonuc</a> = <span class="keyword">new</span> <a class="code" href="classEGS__Interpolator.html" title="A class for fast run-time interpolations.">EGS_Interpolator</a> [<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>];
<a name="l00612"></a>00612             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> imed=0; imed&lt;<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>; imed++) {
<a name="l00613"></a>00613                 <span class="keywordtype">int</span> type;
<a name="l00614"></a>00614                 <span class="keywordtype">int</span> imed1 = imed+1;
<a name="l00615"></a>00615                 type = 3;
<a name="l00616"></a>00616                 __init_interpolator(1,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a6798d306aa53b89d3a41ab14207c7391" title="electron stopping power interpolator">i_ededx</a>[imed]);
<a name="l00617"></a>00617                 type = 4;
<a name="l00618"></a>00618                 __init_interpolator(1,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#aae5f6e44f79bcdd85cfed94727c7d783" title="positron stopping power interpolator">i_pdedx</a>[imed]);
<a name="l00619"></a>00619                 type = 1;
<a name="l00620"></a>00620                 __init_interpolator(1,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a45711991e1c3aaf0af45339d7c318bc7" title="electron cross section interpolator">i_esig</a>[imed]);
<a name="l00621"></a>00621                 type = 2;
<a name="l00622"></a>00622                 __init_interpolator(1,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a629117cc2675f841e2d566566aee35c0" title="positron cross section interpolator">i_psig</a>[imed]);
<a name="l00623"></a>00623                 type = 5;
<a name="l00624"></a>00624                 __init_interpolator(1,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a87dab289c2209afc42af4d9c825517ec" title="electron branching interpolator">i_ebr1</a>[imed]);
<a name="l00625"></a>00625                 type = 6;
<a name="l00626"></a>00626                 __init_interpolator(1,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a4785c4feb0b889c7fc7f0d3a562a0655" title="positron branching 1 interpolator">i_pbr1</a>[imed]);
<a name="l00627"></a>00627                 type = 7;
<a name="l00628"></a>00628                 __init_interpolator(1,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#ab440420c3d2e428750ef944ad4b8329a" title="positron branching 2 interpolator">i_pbr2</a>[imed]);
<a name="l00629"></a>00629                 type = 1;
<a name="l00630"></a>00630                 __init_interpolator(0,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a84f5abc572b724d4d5830544cb2ea969" title="photon mean-free-path interpolator">i_gmfp</a>[imed]);
<a name="l00631"></a>00631                 type = 2;
<a name="l00632"></a>00632                 __init_interpolator(0,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#aef675679d949844efe71e5dc3a0393fd" title="photon branching 1 interpolator">i_gbr1</a>[imed]);
<a name="l00633"></a>00633                 type = 3;
<a name="l00634"></a>00634                 __init_interpolator(0,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a447eae1bc2b0add4ad91476dd4dcd426" title="photon branching 2 interpolator">i_gbr2</a>[imed]);
<a name="l00635"></a>00635                 type = 4;
<a name="l00636"></a>00636                 __init_interpolator(0,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#a85092eb8cd8757b03db0026cb789e53a" title="photon Rayleigh interpolator">i_cohe</a>[imed]);
<a name="l00637"></a>00637                 type = 5;
<a name="l00638"></a>00638                 __init_interpolator(0,imed1,type,<a class="code" href="classEGS__AdvancedApplication.html#aad861bfa243e5dd1278a0906ebde1e7d" title="photonuclear interpolator">i_photonuc</a>[imed]);
<a name="l00639"></a>00639             }
<a name="l00640"></a>00640         }
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;\n\nThe following media are defined:\n&quot;</span>
<a name="l00644"></a>00644                    <span class="stringliteral">&quot;================================\n\n&quot;</span>);
<a name="l00645"></a>00645     EGS_Float Emax = source ? source-&gt;getEmax() : 0;
<a name="l00646"></a>00646     <span class="keywordtype">bool</span> data_ok = <span class="keyword">true</span>;
<a name="l00647"></a>00647     <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="classEGS__AdvancedApplication.html#ad063ecbe686de2d001064628f533e8f4" title="number of media">nmed</a>; j++) {
<a name="l00648"></a>00648         <span class="keywordtype">int</span> imed = ind[j]-1;
<a name="l00649"></a>00649         <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;%3d  %-24s AE=%7.4f AP=%7.4f %d\n&quot;</span>,j,
<a name="l00650"></a>00650                        <a class="code" href="classEGS__Application.html#a8233242b9b4f891ab2b1765c80ec00eb" title="the geometry of this simulation">geometry</a>-&gt;<a class="code" href="classEGS__BaseGeometry.html#ae4e34d2db932d722bde692cc5f584eb3" title="Get the name of medium with index ind.">getMediumName</a>(j),<a class="code" href="egs__interface2_8h.html#af9d67dc22814b5a1fe8766cdb1061f7a" title="The address of the mortran THRESH common block as a pointer to a C-structure of type EGS_Thresh...">the_thresh</a>-&gt;<a class="code" href="structEGS__Thresh.html#a959c64269676f599e222e0c512d320a1">ae</a>[imed],
<a name="l00651"></a>00651                        <a class="code" href="egs__interface2_8h.html#af9d67dc22814b5a1fe8766cdb1061f7a" title="The address of the mortran THRESH common block as a pointer to a C-structure of type EGS_Thresh...">the_thresh</a>-&gt;<a class="code" href="structEGS__Thresh.html#a02673c0d6cc0543439f50a6cf7c33ca3">ap</a>[imed],imed);
<a name="l00652"></a>00652         <span class="keywordflow">if</span> (Emax &gt; <a class="code" href="egs__interface2_8h.html#af9d67dc22814b5a1fe8766cdb1061f7a" title="The address of the mortran THRESH common block as a pointer to a C-structure of type EGS_Thresh...">the_thresh</a>-&gt;<a class="code" href="structEGS__Thresh.html#aaf0848d783ffa69e9992dc97a60f457b">ue</a>[imed]-0.511 ||
<a name="l00653"></a>00653                 Emax &gt; <a class="code" href="egs__interface2_8h.html#af9d67dc22814b5a1fe8766cdb1061f7a" title="The address of the mortran THRESH common block as a pointer to a C-structure of type EGS_Thresh...">the_thresh</a>-&gt;<a class="code" href="structEGS__Thresh.html#a1c5bb2c45074f99dc17bcb3b274b596f">up</a>[imed]) {
<a name="l00654"></a>00654             <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;  upper limits (UE=%g UP=%g) not enough for &quot;</span>
<a name="l00655"></a>00655                            <span class="stringliteral">&quot;maximum source energy (%g)\n&quot;</span>,<a class="code" href="egs__interface2_8h.html#af9d67dc22814b5a1fe8766cdb1061f7a" title="The address of the mortran THRESH common block as a pointer to a C-structure of type EGS_Thresh...">the_thresh</a>-&gt;<a class="code" href="structEGS__Thresh.html#aaf0848d783ffa69e9992dc97a60f457b">ue</a>[imed],
<a name="l00656"></a>00656                            <a class="code" href="egs__interface2_8h.html#af9d67dc22814b5a1fe8766cdb1061f7a" title="The address of the mortran THRESH common block as a pointer to a C-structure of type EGS_Thresh...">the_thresh</a>-&gt;<a class="code" href="structEGS__Thresh.html#a1c5bb2c45074f99dc17bcb3b274b596f">up</a>[imed],Emax);
<a name="l00657"></a>00657             data_ok = <span class="keyword">false</span>;
<a name="l00658"></a>00658         }
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (!data_ok) {
<a name="l00661"></a>00661         <span class="keyword">delete</span> [] ind;
<a name="l00662"></a>00662         <span class="keywordflow">return</span> 3;
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;\n\nTransport parameter and cross section options:\n&quot;</span>
<a name="l00666"></a>00666                    <span class="stringliteral">&quot;==============================================\n&quot;</span>);
<a name="l00667"></a>00667     <span class="keywordtype">int</span> nc = 50;
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (!isspace(<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#a0ce6f7337971b982153417cdd787adfc">pxsec</a>[0])) {
<a name="l00669"></a>00669         pxsec.info(nc);
<a name="l00670"></a>00670     }
<a name="l00671"></a>00671     <span class="keywordflow">if</span> (!isspace(<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#aab3e1a57cdb2097f6af1fdba6b423391">compxsec</a>[0])) {
<a name="l00672"></a>00672         cxsec.info(nc);
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674     pcut.info(nc);
<a name="l00675"></a>00675     pair.info(nc);
<a name="l00676"></a>00676     pang.info(nc);
<a name="l00677"></a>00677     trip.info(nc);
<a name="l00678"></a>00678     bc.info(nc);
<a name="l00679"></a>00679     radc.info(nc);
<a name="l00680"></a>00680     rayl.info(nc);
<a name="l00681"></a>00681     relax.info(nc);
<a name="l00682"></a>00682     iphter.info(nc);
<a name="l00683"></a>00683     photonuc.info(nc);
<a name="l00684"></a>00684     photonucxsec.info(nc);
<a name="l00685"></a>00685     <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00686"></a>00686     ecut.info(nc);
<a name="l00687"></a>00687     brem.info(nc);
<a name="l00688"></a>00688     bang.info(nc);
<a name="l00689"></a>00689     spin.info(nc);
<a name="l00690"></a>00690     eii.info(nc);
<a name="l00691"></a>00691     smax.info(nc);
<a name="l00692"></a>00692     estep.info(nc);
<a name="l00693"></a>00693     ximax.info(nc);
<a name="l00694"></a>00694     bca.info(nc);
<a name="l00695"></a>00695     skind.info(nc);
<a name="l00696"></a>00696     tran.info(nc);
<a name="l00697"></a>00697     <span class="keywordflow">if</span> (efield.size()==3) {
<a name="l00698"></a>00698         efield.info(nc);
<a name="l00699"></a>00699         <a class="code" href="egs__interface2_8h.html#a120dec334c067bbe0d9a6f89b3bb8c44" title="The address of the mortran EMF-INPUTS common block as a pointer to a C-structure of type EGS_emfInput...">the_emf</a>-&gt;<a class="code" href="structEGS__emfInputs.html#a84d39c287caa09e08eb8ac13bf4ba2b1">ExIN</a>=efield_v[0];
<a name="l00700"></a>00700         <a class="code" href="egs__interface2_8h.html#a120dec334c067bbe0d9a6f89b3bb8c44" title="The address of the mortran EMF-INPUTS common block as a pointer to a C-structure of type EGS_emfInput...">the_emf</a>-&gt;EyIN=efield_v[1];
<a name="l00701"></a>00701         <a class="code" href="egs__interface2_8h.html#a120dec334c067bbe0d9a6f89b3bb8c44" title="The address of the mortran EMF-INPUTS common block as a pointer to a C-structure of type EGS_emfInput...">the_emf</a>-&gt;EzIN=efield_v[2];
<a name="l00702"></a>00702     }
<a name="l00703"></a>00703     <span class="keywordflow">if</span> (bfield.size()==3) {
<a name="l00704"></a>00704         bfield.info(nc);
<a name="l00705"></a>00705         <a class="code" href="egs__interface2_8h.html#a120dec334c067bbe0d9a6f89b3bb8c44" title="The address of the mortran EMF-INPUTS common block as a pointer to a C-structure of type EGS_emfInput...">the_emf</a>-&gt;BxIN=bfield_v[0];
<a name="l00706"></a>00706         <a class="code" href="egs__interface2_8h.html#a120dec334c067bbe0d9a6f89b3bb8c44" title="The address of the mortran EMF-INPUTS common block as a pointer to a C-structure of type EGS_emfInput...">the_emf</a>-&gt;ByIN=bfield_v[1];
<a name="l00707"></a>00707         <a class="code" href="egs__interface2_8h.html#a120dec334c067bbe0d9a6f89b3bb8c44" title="The address of the mortran EMF-INPUTS common block as a pointer to a C-structure of type EGS_emfInput...">the_emf</a>-&gt;BzIN=bfield_v[2];
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709     <span class="keywordflow">if</span> (efield.size()==3 || bfield.size()==3) {
<a name="l00710"></a>00710         estepem.info(nc);
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;==============================================\n\n&quot;</span>);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     <span class="keyword">delete</span> [] ind;
<a name="l00716"></a>00716     <span class="keywordflow">return</span> 0;
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="comment">/**********************************************************************</span>
<a name="l00720"></a>00720 <span class="comment">   Set media and corresponding ff file names for custom Rayleigh data</span>
<a name="l00721"></a>00721 <span class="comment"></span>
<a name="l00722"></a>00722 <span class="comment">   Since the_xoptions-&gt;iraylr is reset to 1 here, output will only</span>
<a name="l00723"></a>00723 <span class="comment">   indicate coherent scatter is on, but not whether custom input</span>
<a name="l00724"></a>00724 <span class="comment">   requested. Perhaps should make EGS check for iraylm(medium)&gt;0</span>
<a name="l00725"></a>00725 <span class="comment">   instead of iraylm(medium)=1. The latter has been kept over</span>
<a name="l00726"></a>00726 <span class="comment">   the years for historic reasons.</span>
<a name="l00727"></a>00727 <span class="comment">                                                    EMH April 6th 2011</span>
<a name="l00728"></a>00728 <span class="comment">**********************************************************************/</span>
<a name="l00729"></a><a class="code" href="classEGS__AdvancedApplication.html#a9e7bb40054e0b06772d5ba2aecebe3f0">00729</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#a9e7bb40054e0b06772d5ba2aecebe3f0" title="Custom Rayleigh data setup.">EGS_AdvancedApplication::setRayleighData</a>(
<a name="l00730"></a>00730     <span class="keyword">const</span> vector&lt;string&gt; &amp;str_medium,
<a name="l00731"></a>00731     <span class="keyword">const</span> vector&lt;string&gt; &amp;str_file) {
<a name="l00732"></a>00732     <a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#a7715f3c59f7282ac64bd00473099db58">iraylr</a>=1;
<a name="l00733"></a>00733     <span class="keywordtype">int</span> i,k;
<a name="l00734"></a>00734     <span class="keywordflow">for</span> (i=0; i&lt;str_medium.size(); i++) {
<a name="l00735"></a>00735         <span class="keywordflow">for</span> (k=0; k&lt;str_medium[i].size(); k++) {
<a name="l00736"></a>00736             <a class="code" href="egs__interface2_8h.html#abfa0905bf22dda81b7332663c7dc161b" title="The address of the mortran rayleigh_inputs common block as a pointer to a C-structure of type EGS_Ray...">the_rayleigh</a>-&gt;<a class="code" href="structEGS__Rayleigh.html#a36927dd18fd1e467eba0e8b807928865">ff_media</a>[i][k]= str_medium[i][k];
<a name="l00737"></a>00737         }
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739     <span class="keywordflow">for</span> (i=0; i&lt;str_file.size(); i++) {
<a name="l00740"></a>00740         <span class="keywordflow">for</span> (k=0; k&lt;str_file[i].size(); k++) {
<a name="l00741"></a>00741             <a class="code" href="egs__interface2_8h.html#abfa0905bf22dda81b7332663c7dc161b" title="The address of the mortran rayleigh_inputs common block as a pointer to a C-structure of type EGS_Ray...">the_rayleigh</a>-&gt;<a class="code" href="structEGS__Rayleigh.html#a3283f12d73c4b97b0e41bb513a83a762">ff_file</a>[i][k]=str_file[i][k];
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 <span class="comment">/**********************************************************************</span>
<a name="l00747"></a>00747 <span class="comment">   Set EII flag and xsection file name.</span>
<a name="l00748"></a>00748 <span class="comment"></span>
<a name="l00749"></a>00749 <span class="comment">   The EII input is of a mixed type, i.e., one should be able to turn</span>
<a name="l00750"></a>00750 <span class="comment">   this option on/off, but there is also the possibility of using an</span>
<a name="l00751"></a>00751 <span class="comment">   arbitrary EII xsection compilation, including the available EII</span>
<a name="l00752"></a>00752 <span class="comment">   xsections with EGSnrc.</span>
<a name="l00753"></a>00753 <span class="comment">                                                    EMH April 6th 2011</span>
<a name="l00754"></a>00754 <span class="comment">**********************************************************************/</span>
<a name="l00755"></a><a class="code" href="classEGS__AdvancedApplication.html#a5353a5522bbe6f2cafa947f7903ae559">00755</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#a5353a5522bbe6f2cafa947f7903ae559" title="Set EII flag and xsection file name.">EGS_AdvancedApplication::setEIIData</a>(EGS_I32 len) {
<a name="l00756"></a>00756     <span class="keywordtype">string</span> str_eii,off,on;
<a name="l00757"></a>00757     <a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#aee0e4a76d66e89651bab09c4702a76c6">eii_flag</a> = 1;
<a name="l00758"></a>00758     <span class="keywordtype">string</span> ik=<span class="stringliteral">&quot;ik&quot;</span>;
<a name="l00759"></a>00759     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;len; i++) {
<a name="l00760"></a>00760         str_eii += toupper(<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#a181ff35de96cca8d89620e21754156af">eiixsec</a>[i]);
<a name="l00761"></a>00761         off+=<span class="charliteral">&#39; &#39;</span>;
<a name="l00762"></a>00762         on+=<span class="charliteral">&#39; &#39;</span>;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764     off[0]=<span class="charliteral">&#39;O&#39;</span>;
<a name="l00765"></a>00765     off[1]=<span class="charliteral">&#39;F&#39;</span>;
<a name="l00766"></a>00766     off[2]=<span class="charliteral">&#39;F&#39;</span>;
<a name="l00767"></a>00767     on[0]=<span class="charliteral">&#39;O&#39;</span>;
<a name="l00768"></a>00768     on[1]=<span class="charliteral">&#39;N&#39;</span>;
<a name="l00769"></a>00769     <span class="keywordflow">if</span> (str_eii == off) {
<a name="l00770"></a>00770         <a class="code" href="egs__interface2_8h.html#a9a02efb22b05e9a1e826d22c05a17289" title="The address of the mortran cross section options common block as a pointer to a C-structure of type E...">the_xoptions</a>-&gt;<a class="code" href="structEGS__XOptions.html#aee0e4a76d66e89651bab09c4702a76c6">eii_flag</a> = 0;
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str_eii == on) {
<a name="l00773"></a>00773         strcpy(<a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#a181ff35de96cca8d89620e21754156af">eiixsec</a>,ik.c_str());
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775 }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="preprocessor">#ifdef GDEBUG</span>
<a name="l00778"></a>00778 <span class="preprocessor"></span><span class="preprocessor">    #define MAX_STEP 100000</span>
<a name="l00779"></a>00779 <span class="preprocessor"></span>    <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> steps_x[MAX_STEP], steps_u[MAX_STEP];
<a name="l00780"></a>00780     <span class="keywordtype">int</span> steps_ireg[MAX_STEP], steps_inew[MAX_STEP];
<a name="l00781"></a>00781     EGS_Float steps_ustepi[MAX_STEP], steps_ustepf[MAX_STEP];
<a name="l00782"></a>00782     <span class="keywordtype">int</span> steps_n = 0;
<a name="l00783"></a>00783 <span class="preprocessor">#endif</span>
<a name="l00784"></a>00784 <span class="preprocessor"></span>
<a name="l00785"></a><a class="code" href="classEGS__AdvancedApplication.html#aeb82ecc8a9747a2bb4b3524c06b69811">00785</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#aeb82ecc8a9747a2bb4b3524c06b69811" title="Simulate a single shower.">EGS_AdvancedApplication::shower</a>() {
<a name="l00786"></a>00786     <span class="keywordflow">if</span> (!<a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#ac7ae1e0704893496f97ac7a14f5a2ac9" title="statistical weight">wt</a>) {
<a name="l00787"></a>00787         <span class="keywordflow">return</span> 0;
<a name="l00788"></a>00788     }
<a name="l00789"></a>00789     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a054b5f967362fb583b08aa141d44d274">E</a>[0] = (<a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#af26c5d234990b6e381951bc145bb54dc" title="particle charge">q</a>) ? <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a7309afe2c0313bfdaae55fb1492b3000" title="particle energy in MeV">E</a> + <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a65779a8f4b47d673a45c274fadcde881" title="Electron rest energy.">rm</a> : <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a7309afe2c0313bfdaae55fb1492b3000" title="particle energy in MeV">E</a>;
<a name="l00790"></a>00790     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a3e1893b08c58c1930215b05ffd3b200c">x</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a1c5644748c45c659823ca427a4b656a3" title="position">x</a>.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>;
<a name="l00791"></a>00791     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abaeb3b4d4df09253d62ecf9c866a75b5">y</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a1c5644748c45c659823ca427a4b656a3" title="position">x</a>.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>;
<a name="l00792"></a>00792     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a039c1ec16171ca522ded52bbfa220ec9">z</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a1c5644748c45c659823ca427a4b656a3" title="position">x</a>.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>;
<a name="l00793"></a>00793     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abcce3249128b99879d88aefc0e747adb">u</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a7d4bbcdbe24280b6ba3076aae99aba7b" title="direction">u</a>.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>;
<a name="l00794"></a>00794     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a74269a7153ecdc20f966ac7e7a4900e3">v</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a7d4bbcdbe24280b6ba3076aae99aba7b" title="direction">u</a>.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>;
<a name="l00795"></a>00795     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a792b83be2582af5596c36966e634d748">w</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a7d4bbcdbe24280b6ba3076aae99aba7b" title="direction">u</a>.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>;
<a name="l00796"></a>00796     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#aa65fb07480cc203fcc91ea6411a9d21b">dnear</a>[0] = 0;
<a name="l00797"></a>00797     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abde65475db0a8c4350dadf06a7ac2375">wt</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#ac7ae1e0704893496f97ac7a14f5a2ac9" title="statistical weight">wt</a>;
<a name="l00798"></a>00798     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a7b57f3b0571707c6bb4cb4f65720af75">ir</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#a98afd4312de1e67409df64fabaf2b690" title="particle region index">ir</a> + 2;
<a name="l00799"></a>00799     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a9a8a5f250531ac78188175d4903abd4d">iq</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#af26c5d234990b6e381951bc145bb54dc" title="particle charge">q</a>;
<a name="l00800"></a>00800     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#afaaf57ba783e01b7f0a0aeb6fbe0447c">latch</a>[0] = <a class="code" href="classEGS__Application.html#a6fd58166cb82b03b7861e0a2352d7494">p</a>.<a class="code" href="structEGS__Particle.html#ab4e1781369d554b3a1dd7ee305e27466" title="latch variable (useful as a flag on many occasions)">latch</a>;
<a name="l00801"></a>00801     <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#af5e322d06055d31869c5c45cb6e462d1">np</a> = 1;
<a name="l00802"></a>00802 #ifdef GDEBUG
<a name="l00803"></a>00803     steps_n = 0;
<a name="l00804"></a>00804 #endif
<a name="l00805"></a>00805     <a class="code" href="egs__interface2_8h.html#a3ccc560ae1739327959ffd5484f6bc03" title="Transport the particles currently on the particle stack.">egsShower</a>();
<a name="l00806"></a>00806     <span class="keywordflow">return</span> 0;
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808 
<a name="l00809"></a><a class="code" href="classEGS__AdvancedApplication.html#a32e015e71c82c28f3c361dca509ab1dd">00809</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#a32e015e71c82c28f3c361dca509ab1dd" title="Finish a simulation.">EGS_AdvancedApplication::finishRun</a>() {
<a name="l00810"></a>00810     <a class="code" href="egs__interface2_8h.html#ab8fcef4d859dc234e9cd3c1e0df877d8" title="Finish a simulation.">egsFinish</a>();
<a name="l00811"></a>00811     <span class="comment">//egsSetDefaultIOFunctions();</span>
<a name="l00812"></a>00812     <a class="code" href="classEGS__AdvancedApplication.html#a1bc6271383bbee83bb49141460fbe086" title="determines how to write info">io_flag</a> = 0;
<a name="l00813"></a>00813     <span class="comment">// so that if extra output is being produced somewhere, it does not</span>
<a name="l00814"></a>00814     <span class="comment">// go to fort.6 as it would without this as all fortran units are</span>
<a name="l00815"></a>00815     <span class="comment">// closed after egsFinish().</span>
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00818"></a><a class="code" href="classEGS__AdvancedApplication.html#a95905591d4fd2397c0ef48508ccd0289">00818</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#a95905591d4fd2397c0ef48508ccd0289" title="Finish the simulation.">EGS_AdvancedApplication::finishSimulation</a>() {
<a name="l00819"></a>00819     <span class="keywordtype">int</span> err = <a class="code" href="classEGS__AdvancedApplication.html#a95905591d4fd2397c0ef48508ccd0289" title="Finish the simulation.">EGS_Application::finishSimulation</a>();
<a name="l00820"></a>00820     <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;finishSimulation(%s) %d\n&quot;</span>,<a class="code" href="classEGS__Application.html#a6770bcae39d6f93a483fa578a4c5e7f5" title="The application name.">app_name</a>.c_str(),err);
<a name="l00821"></a>00821     <span class="keywordflow">if</span> (err &lt;= 0) {
<a name="l00822"></a>00822         <span class="keywordflow">return</span> err;
<a name="l00823"></a>00823     }
<a name="l00824"></a>00824     <span class="comment">//egsInformation(&quot;\n\n********** I&#39;m last job! **********\n\n&quot;);</span>
<a name="l00825"></a>00825     <span class="comment">//return 0;</span>
<a name="l00826"></a>00826     <span class="comment">// if err is positive, this is the last job in a parallel run</span>
<a name="l00827"></a>00827     <span class="comment">// =&gt; we have to combine the results</span>
<a name="l00828"></a>00828     <span class="comment">// EGS_Application::finishSimulation() has already called</span>
<a name="l00829"></a>00829     <span class="comment">// our finishRun() which has called egs_finish =&gt; all data has been</span>
<a name="l00830"></a>00830     <span class="comment">// moved to the user code directory and the working directory has been</span>
<a name="l00831"></a>00831     <span class="comment">// reset to be the user code directory. We must now reset the</span>
<a name="l00832"></a>00832     <span class="comment">// output_file name and re-open units.</span>
<a name="l00833"></a>00833     <a class="code" href="classEGS__Application.html#a32f097ac9dd4e520b289b681c732f131" title="The output file name (no extension)">output_file</a> = <a class="code" href="classEGS__Application.html#a7d130fd20136a021a19dee1ca9c15848" title="The final output file name.">final_output_file</a>;
<a name="l00834"></a>00834     <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;i_parallel = 0;
<a name="l00835"></a>00835     <span class="keywordtype">int</span> flag = 0;
<a name="l00836"></a>00836     egsOpenUnits(&amp;flag);
<a name="l00837"></a>00837     <span class="comment">// The following is necessary because finishRun() was called from</span>
<a name="l00838"></a>00838     <span class="comment">// EGS_Application::finishSimulation() and this resets I/O</span>
<a name="l00839"></a>00839     <span class="comment">// to stdout and stderr. But if we are here, we are combining</span>
<a name="l00840"></a>00840     <span class="comment">// the results of a parallel run and we want the output to go</span>
<a name="l00841"></a>00841     <span class="comment">// into the combined run log file.</span>
<a name="l00842"></a>00842     <span class="comment">//egsSetInfoFunction(Information,__write_to_fortran_file);</span>
<a name="l00843"></a>00843     <span class="comment">//egsSetInfoFunction(Warning,__write_to_fortran_file);</span>
<a name="l00844"></a>00844     <span class="comment">//egsSetInfoFunction(Fatal,__write_to_fortran_file_and_exit);</span>
<a name="l00845"></a>00845     <a class="code" href="classEGS__AdvancedApplication.html#a1bc6271383bbee83bb49141460fbe086" title="determines how to write info">io_flag</a> = 1;
<a name="l00846"></a>00846     <a class="code" href="classEGS__AdvancedApplication.html#a7235c49cea1062da92cd0b09e192cf48" title="Is this the final job of a parallel run ?">final_job</a> = <span class="keyword">true</span>;
<a name="l00847"></a>00847     <a class="code" href="classEGS__Application.html#ac6e9efe53e0f3868fd947e6da448a035" title="Describe the user code.">describeUserCode</a>();
<a name="l00848"></a>00848     <a class="code" href="classEGS__AdvancedApplication.html#af70c20ea7cb0bf1997f3761e79b0c6ca" title="Describe the simulation.">describeSimulation</a>();
<a name="l00849"></a>00849     err = <a class="code" href="classEGS__Application.html#ad79975ab3d843f8535d2a223992a43ab" title="Combine results from parallel runs.">combineResults</a>();
<a name="l00850"></a>00850     <span class="keywordflow">if</span> (err) {
<a name="l00851"></a>00851         <span class="keywordflow">return</span> err;
<a name="l00852"></a>00852     }
<a name="l00853"></a>00853     <a class="code" href="classEGS__Application.html#ac5109765b1ca4ced5c8766d51258bbcd" title="the run control object.">run</a>-&gt;<a class="code" href="classEGS__RunControl.html#aee4ef811f7ab78bc823254669ea5f2a9">finishSimulation</a>();
<a name="l00854"></a>00854     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classEGS__Application.html#a2e7626554b1f41df3961cb1a5a81baed" title="The ausgab objects.">a_objects_list</a>.size(); ++j) {
<a name="l00855"></a>00855         <a class="code" href="classEGS__Application.html#a2e7626554b1f41df3961cb1a5a81baed" title="The ausgab objects.">a_objects_list</a>[j]-&gt;reportResults();
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857     <a class="code" href="classEGS__Application.html#a6c5e36aaaf4dbfe46a9b0a240273c07a" title="Output the simulation results.">outputResults</a>();
<a name="l00858"></a>00858     <a class="code" href="classEGS__AdvancedApplication.html#a32e015e71c82c28f3c361dca509ab1dd" title="Finish a simulation.">finishRun</a>();
<a name="l00859"></a>00859     <span class="keywordflow">return</span> 0;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a><a class="code" href="classEGS__AdvancedApplication.html#a5938d12d44e755accaacd79aa92c805c">00862</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#a5938d12d44e755accaacd79aa92c805c" title="Output intermediate results.">EGS_AdvancedApplication::outputData</a>() {
<a name="l00863"></a>00863     <span class="keywordtype">int</span> err = <a class="code" href="classEGS__AdvancedApplication.html#a5938d12d44e755accaacd79aa92c805c" title="Output intermediate results.">EGS_Application::outputData</a>();
<a name="l00864"></a>00864     <span class="keywordflow">if</span> (err) {
<a name="l00865"></a>00865         <span class="keywordflow">return</span> err;
<a name="l00866"></a>00866     }
<a name="l00867"></a>00867     EGS_I32 np, ip;
<a name="l00868"></a>00868     egsGetRNGPointers(&amp;np,&amp;ip);
<a name="l00869"></a>00869     <span class="keywordflow">if</span> (np &lt; 1) {
<a name="l00870"></a>00870         <span class="keywordflow">return</span> 11;
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872     <span class="keywordflow">if</span> (np &gt; 10000000) {
<a name="l00873"></a>00873         <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;EGS_AdvancedApplication::outputData(): egsGetRNGPointers&quot;</span>
<a name="l00874"></a>00874                    <span class="stringliteral">&quot; returns a huge number? (%d)\n&quot;</span>,np);
<a name="l00875"></a>00875         <span class="keywordflow">return</span> 12;
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877     EGS_Float *array = <span class="keyword">new</span> EGS_Float [np];
<a name="l00878"></a>00878     egsGetRNGArray(array);
<a name="l00879"></a>00879     (*data_out) &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; np &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; ip &lt;&lt; endl;
<a name="l00880"></a>00880     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;np; j++) {
<a name="l00881"></a>00881         (*data_out) &lt;&lt; array[j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00882"></a>00882     }
<a name="l00883"></a>00883     (*data_out) &lt;&lt; endl;
<a name="l00884"></a>00884     <span class="keywordtype">double</span> ch_steps, all_steps;
<a name="l00885"></a>00885     egsGetSteps(&amp;ch_steps,&amp;all_steps);
<a name="l00886"></a>00886     (*data_out) &lt;&lt; ch_steps &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; all_steps &lt;&lt; endl;
<a name="l00887"></a>00887     <span class="keyword">delete</span> [] array;
<a name="l00888"></a>00888     <span class="keywordflow">return</span> <a class="code" href="classEGS__Application.html#ab382f1b191803900a08a11decdd71714" title="data output stream">data_out</a>-&gt;good() ? 0 : 13;
<a name="l00889"></a>00889 }
<a name="l00890"></a>00890 
<a name="l00891"></a><a class="code" href="classEGS__AdvancedApplication.html#a06f19f07a28df1d2384ee29addace191">00891</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#a06f19f07a28df1d2384ee29addace191" title="Read intermediate results.">EGS_AdvancedApplication::readData</a>() {
<a name="l00892"></a>00892     <span class="keywordtype">int</span> err = <a class="code" href="classEGS__AdvancedApplication.html#a06f19f07a28df1d2384ee29addace191" title="Read intermediate results.">EGS_Application::readData</a>();
<a name="l00893"></a>00893     <span class="keywordflow">if</span> (err) {
<a name="l00894"></a>00894         <span class="keywordflow">return</span> err;
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896     <span class="keywordtype">int</span> np, ip;
<a name="l00897"></a>00897     (*data_in) &gt;&gt; np &gt;&gt; ip;
<a name="l00898"></a>00898     <span class="keywordflow">if</span> (np &lt; 1) {
<a name="l00899"></a>00899         <span class="keywordflow">return</span> 11;
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901     <span class="keywordflow">if</span> (np &gt; 10000000) {
<a name="l00902"></a>00902         <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;EGS_AdvancedApplication::readData(): got huge size &quot;</span>
<a name="l00903"></a>00903                    <span class="stringliteral">&quot;for the mortran random array? (%d)\n&quot;</span>,np);
<a name="l00904"></a>00904         <span class="keywordflow">return</span> 12;
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906     EGS_Float *array = <span class="keyword">new</span> EGS_Float [np];
<a name="l00907"></a>00907     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;np; j++) {
<a name="l00908"></a>00908         (*data_in) &gt;&gt; array[j];
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (!<a class="code" href="classEGS__Application.html#a978476a101fc626a2cfa8d2c18a244f9" title="data input stream">data_in</a>-&gt;good()) {
<a name="l00911"></a>00911         <span class="keywordflow">return</span> 13;
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913     egsSetRNGState(&amp;ip,array);
<a name="l00914"></a>00914     <span class="keyword">delete</span> [] array;
<a name="l00915"></a>00915     <span class="keywordtype">double</span> ch_steps, all_steps;
<a name="l00916"></a>00916     (*data_in) &gt;&gt; ch_steps &gt;&gt; all_steps;
<a name="l00917"></a>00917     egsSetSteps(&amp;ch_steps,&amp;all_steps);
<a name="l00918"></a>00918     <span class="keywordflow">return</span> <a class="code" href="classEGS__Application.html#a978476a101fc626a2cfa8d2c18a244f9" title="data input stream">data_in</a>-&gt;good() ? 0 : 13;
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 
<a name="l00921"></a><a class="code" href="classEGS__AdvancedApplication.html#afcbb19952d15adab639d67aae2db166c">00921</a> <span class="keywordtype">int</span> <a class="code" href="classEGS__AdvancedApplication.html#afcbb19952d15adab639d67aae2db166c" title="Add data from a parallel job.">EGS_AdvancedApplication::addState</a>(istream &amp;data) {
<a name="l00922"></a>00922     <span class="keywordtype">int</span> err = <a class="code" href="classEGS__AdvancedApplication.html#afcbb19952d15adab639d67aae2db166c" title="Add data from a parallel job.">EGS_Application::addState</a>(data);
<a name="l00923"></a>00923     <span class="keywordflow">if</span> (err) {
<a name="l00924"></a>00924         <span class="keywordflow">return</span> err;
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926     <span class="keywordtype">int</span> np, ip;
<a name="l00927"></a>00927     data &gt;&gt; np &gt;&gt; ip;
<a name="l00928"></a>00928     <span class="keywordflow">if</span> (np &lt; 1) {
<a name="l00929"></a>00929         <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;Got np=%d\n&quot;</span>,np);
<a name="l00930"></a>00930         <span class="keywordflow">return</span> 11;
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932     <span class="keywordflow">if</span> (np &gt; 10000000) {
<a name="l00933"></a>00933         <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;EGS_AdvancedApplication::addState(): got huge size &quot;</span>
<a name="l00934"></a>00934                    <span class="stringliteral">&quot;for the mortran random array? (%d)\n&quot;</span>,np);
<a name="l00935"></a>00935         <span class="keywordflow">return</span> 12;
<a name="l00936"></a>00936     }
<a name="l00937"></a>00937     EGS_Float *array = <span class="keyword">new</span> EGS_Float [np];
<a name="l00938"></a>00938     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;np; j++) {
<a name="l00939"></a>00939         data &gt;&gt; array[j];
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941     <span class="keywordflow">if</span> (!data.good()) {
<a name="l00942"></a>00942         <span class="keywordflow">return</span> 13;
<a name="l00943"></a>00943     }
<a name="l00944"></a>00944     egsSetRNGState(&amp;ip,array);
<a name="l00945"></a>00945     <span class="keyword">delete</span> [] array;
<a name="l00946"></a>00946     <span class="keywordtype">double</span> ch_steps, all_steps;
<a name="l00947"></a>00947     data &gt;&gt; ch_steps &gt;&gt; all_steps;
<a name="l00948"></a>00948     <span class="keywordtype">double</span> ch_steps_old, all_steps_old;
<a name="l00949"></a>00949     egsGetSteps(&amp;ch_steps_old,&amp;all_steps_old);
<a name="l00950"></a>00950     ch_steps += ch_steps_old;
<a name="l00951"></a>00951     all_steps += all_steps_old;
<a name="l00952"></a>00952     egsSetSteps(&amp;ch_steps,&amp;all_steps);
<a name="l00953"></a>00953     <span class="keywordflow">return</span> data.good() ? 0 : 13;
<a name="l00954"></a>00954 }
<a name="l00955"></a>00955 
<a name="l00956"></a><a class="code" href="classEGS__AdvancedApplication.html#a014bd195880a2870c8e194a4e70ca65d">00956</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#a014bd195880a2870c8e194a4e70ca65d" title="Reset the application to a &amp;#39;pristine&amp;#39; state.">EGS_AdvancedApplication::resetCounter</a>() {
<a name="l00957"></a>00957     <a class="code" href="classEGS__AdvancedApplication.html#a014bd195880a2870c8e194a4e70ca65d" title="Reset the application to a &amp;#39;pristine&amp;#39; state.">EGS_Application::resetCounter</a>();
<a name="l00958"></a>00958     <span class="keywordtype">double</span> ch_steps = 0, all_steps = 0;
<a name="l00959"></a>00959     egsSetSteps(&amp;ch_steps,&amp;all_steps);
<a name="l00960"></a>00960 }
<a name="l00961"></a>00961 
<a name="l00962"></a><a class="code" href="classEGS__AdvancedApplication.html#ab9dfdb336e7db115070f1138935b11fa">00962</a> EGS_I64 <a class="code" href="classEGS__AdvancedApplication.html#ab9dfdb336e7db115070f1138935b11fa" title="Get the number of random numbers used.">EGS_AdvancedApplication::randomNumbersUsed</a>()<span class="keyword"> const </span>{
<a name="l00963"></a>00963     EGS_I64 nused = <a class="code" href="classEGS__AdvancedApplication.html#ab9dfdb336e7db115070f1138935b11fa" title="Get the number of random numbers used.">EGS_Application::randomNumbersUsed</a>();
<a name="l00964"></a>00964     EGS_I32 np, ip;
<a name="l00965"></a>00965     egsGetRNGPointers(&amp;np,&amp;ip);
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (ip &lt;= np) {
<a name="l00967"></a>00967         nused -= (np+1-ip);
<a name="l00968"></a>00968     }
<a name="l00969"></a>00969     <span class="keywordflow">return</span> nused;
<a name="l00970"></a>00970 }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 <span class="keywordtype">void</span> EGS_AdvancedApplication::appInformation(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg) {
<a name="l00973"></a>00973     <span class="keywordflow">if</span> (!msg) {
<a name="l00974"></a>00974         <span class="keywordflow">return</span>;
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976     <span class="keywordflow">if</span> (!<a class="code" href="classEGS__AdvancedApplication.html#a1bc6271383bbee83bb49141460fbe086" title="determines how to write info">io_flag</a>) {
<a name="l00977"></a>00977         <a class="code" href="classEGS__Application.html#aa7212ca64f07f679cc6e8345d95132c8" title="Write an information message.">EGS_Application::appInformation</a>(msg);
<a name="l00978"></a>00978     }
<a name="l00979"></a>00979     <span class="keywordflow">else</span> {
<a name="l00980"></a>00980         <span class="keywordtype">int</span> ounit = <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;i_log;
<a name="l00981"></a>00981         F77_OBJ_(egs_write_string,EGS_WRITE_STRING)(&amp;ounit,msg,strlen(msg));
<a name="l00982"></a>00982         <a class="code" href="classEGS__Application.html#ae92ccfee331df800e980266bd71cf91b" title="Check if a device holding a given stream is full.">checkDeviceFull</a>(stdout);
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 <span class="keywordtype">void</span> EGS_AdvancedApplication::appWarning(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg) {
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (!msg) {
<a name="l00988"></a>00988         <span class="keywordflow">return</span>;
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990     <span class="keywordflow">if</span> (!<a class="code" href="classEGS__AdvancedApplication.html#a1bc6271383bbee83bb49141460fbe086" title="determines how to write info">io_flag</a>) {
<a name="l00991"></a>00991         <a class="code" href="classEGS__Application.html#ab5b299d7edb8aa5f368dccef4e51f03e" title="Write a warning message.">EGS_Application::appWarning</a>(msg);
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993     <span class="keywordflow">else</span> {
<a name="l00994"></a>00994         <span class="keywordtype">int</span> ounit = <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;i_log;
<a name="l00995"></a>00995         F77_OBJ_(egs_write_string,EGS_WRITE_STRING)(&amp;ounit,msg,strlen(msg));
<a name="l00996"></a>00996         <a class="code" href="classEGS__Application.html#ae92ccfee331df800e980266bd71cf91b" title="Check if a device holding a given stream is full.">checkDeviceFull</a>(stdout);
<a name="l00997"></a>00997     }
<a name="l00998"></a>00998 }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000 <span class="keywordtype">void</span> EGS_AdvancedApplication::appFatal(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg) {
<a name="l01001"></a>01001     <span class="keywordflow">if</span> (!<a class="code" href="classEGS__AdvancedApplication.html#a1bc6271383bbee83bb49141460fbe086" title="determines how to write info">io_flag</a>) {
<a name="l01002"></a>01002         <a class="code" href="classEGS__Application.html#a4e6bdc981453861541b4c757f53d8c23" title="Write a warning message and exit.">EGS_Application::appFatal</a>(msg);
<a name="l01003"></a>01003     }
<a name="l01004"></a>01004     <span class="keywordflow">else</span> {
<a name="l01005"></a>01005         <span class="keywordflow">if</span> (msg) {
<a name="l01006"></a>01006             <span class="keywordtype">int</span> ounit = <a class="code" href="egs__interface2_8h.html#aeb9a62080dd610d1d1ea7c77bfba4b9f" title="The address of the mortran egs_io common block as a pointer to a C-structure of type EGS_IO...">the_egsio</a>-&gt;i_log;
<a name="l01007"></a>01007             F77_OBJ_(egs_write_string,EGS_WRITE_STRING)(&amp;ounit,msg,strlen(msg));
<a name="l01008"></a>01008         }
<a name="l01009"></a>01009         exit(1);
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a><a class="code" href="classEGS__AdvancedApplication.html#a1d9c258426bc0230ee1de96925745131">01013</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#a1d9c258426bc0230ee1de96925745131" title="Get the number of condensed history and all electron steps.">EGS_AdvancedApplication::getElectronSteps</a>(<span class="keywordtype">double</span> &amp;ch_steps,
<a name="l01014"></a>01014         <span class="keywordtype">double</span> &amp;all_steps)<span class="keyword"> const </span>{
<a name="l01015"></a>01015     egsGetSteps(&amp;ch_steps,&amp;all_steps);
<a name="l01016"></a>01016 }
<a name="l01017"></a>01017 
<a name="l01018"></a><a class="code" href="classEGS__AdvancedApplication.html#a85d54711a00e50443963a9fc9d94e08e">01018</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#a85d54711a00e50443963a9fc9d94e08e" title="Start the transport of a new particle.">EGS_AdvancedApplication::startNewParticle</a>() {
<a name="l01019"></a>01019     <span class="keywordflow">if</span> (<a class="code" href="classEGS__Application.html#a8233242b9b4f891ab2b1765c80ec00eb" title="the geometry of this simulation">geometry</a>-&gt;<a class="code" href="classEGS__BaseGeometry.html#a219442f94535ac16c3a098b256d3a229" title="Does this geometry object have a mass density scaling feature?">hasRhoScaling</a>()) {
<a name="l01020"></a>01020         <span class="keywordtype">int</span> ireg = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a7b57f3b0571707c6bb4cb4f65720af75">ir</a>[<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#af5e322d06055d31869c5c45cb6e462d1">np</a>-1] - 2;
<a name="l01021"></a>01021         EGS_Float rho = <a class="code" href="classEGS__Application.html#a8233242b9b4f891ab2b1765c80ec00eb" title="the geometry of this simulation">geometry</a>-&gt;<a class="code" href="classEGS__BaseGeometry.html#ae73ccf5d1d1264f3865b275a99ce1377" title="Get the relative mass density in region ireg.">getRelativeRho</a>(ireg);
<a name="l01022"></a>01022         <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a230a1b0dfa8098c4550729cef128085e" title="Mass density ratio.">rhor</a> = rho;
<a name="l01023"></a>01023         <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a807e35cfbf24c03d3691deb6f0da1596" title="Mass density ratio in the new region.">rhor_new</a> = rho;
<a name="l01024"></a>01024     }
<a name="l01025"></a>01025     <span class="keywordflow">else</span> {
<a name="l01026"></a>01026         <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a230a1b0dfa8098c4550729cef128085e" title="Mass density ratio.">rhor</a> = 1;
<a name="l01027"></a>01027         <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a807e35cfbf24c03d3691deb6f0da1596" title="Mass density ratio in the new region.">rhor_new</a> = 1;
<a name="l01028"></a>01028     }
<a name="l01029"></a>01029 }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031 <span class="keywordtype">void</span> EGS_AdvancedApplication::enterNewRegion() {
<a name="l01032"></a>01032     <span class="keywordflow">if</span> (<a class="code" href="classEGS__Application.html#a8233242b9b4f891ab2b1765c80ec00eb" title="the geometry of this simulation">geometry</a>-&gt;<a class="code" href="classEGS__BaseGeometry.html#a219442f94535ac16c3a098b256d3a229" title="Does this geometry object have a mass density scaling feature?">hasRhoScaling</a>()) {
<a name="l01033"></a>01033         <span class="keywordtype">int</span> ireg = <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#aeb1311ded669a1d31986959c7b8657e6">irnew</a>-2;
<a name="l01034"></a>01034         <span class="keywordflow">if</span> (ireg &gt;= 0) {
<a name="l01035"></a>01035             EGS_Float rho = <a class="code" href="classEGS__Application.html#a8233242b9b4f891ab2b1765c80ec00eb" title="the geometry of this simulation">geometry</a>-&gt;<a class="code" href="classEGS__BaseGeometry.html#ae73ccf5d1d1264f3865b275a99ce1377" title="Get the relative mass density in region ireg.">getRelativeRho</a>(ireg);
<a name="l01036"></a>01036             <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a807e35cfbf24c03d3691deb6f0da1596" title="Mass density ratio in the new region.">rhor_new</a> = rho;
<a name="l01037"></a>01037         }
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039     <span class="keywordflow">else</span> {
<a name="l01040"></a>01040         <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a807e35cfbf24c03d3691deb6f0da1596" title="Mass density ratio in the new region.">rhor_new</a> = 1;
<a name="l01041"></a>01041     }
<a name="l01042"></a>01042 }
<a name="l01043"></a>01043 
<a name="l01044"></a><a class="code" href="classEGS__AdvancedApplication.html#a0d20d779c31763413dfc79b7a4bce495">01044</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#a0d20d779c31763413dfc79b7a4bce495">EGS_AdvancedApplication::saveRNGState</a>() {
<a name="l01045"></a>01045     <a class="code" href="classEGS__Application.html#a1ae856ff8e9615b6f353f4d501d1d5b7" title="the random number generator">rndm</a>-&gt;<a class="code" href="classEGS__RandomGenerator.html#a661341fa37cd14fdeb3ecf2e92cbe81c" title="Save the RNG state.">saveState</a>();
<a name="l01046"></a>01046     <span class="keywordtype">int</span> np,ip;
<a name="l01047"></a>01047     egsGetRNGPointers(&amp;np,&amp;ip);
<a name="l01048"></a>01048     <span class="keywordflow">if</span> (<a class="code" href="classEGS__AdvancedApplication.html#acaf275fb4a58347356e836a1b9122d0e" title="Size of the RNG buffer.">n_rng_buffer</a> &gt; 0) {
<a name="l01049"></a>01049         <span class="keywordflow">if</span> (np != <a class="code" href="classEGS__AdvancedApplication.html#acaf275fb4a58347356e836a1b9122d0e" title="Size of the RNG buffer.">n_rng_buffer</a>) <a class="code" href="group__egspp__main.html#ga4454fdf3403e87c098cd55f60dedbe56" title="Always use this function for reporting fatal errors.">egsFatal</a>(<span class="stringliteral">&quot;EGS_AdvancedApplication::saveRNGState:\n&quot;</span>
<a name="l01050"></a>01050                                              <span class="stringliteral">&quot;  new buffer size (%d) is not the same as previous size(%d) ?\n&quot;</span>,
<a name="l01051"></a>01051                                              np,<a class="code" href="classEGS__AdvancedApplication.html#acaf275fb4a58347356e836a1b9122d0e" title="Size of the RNG buffer.">n_rng_buffer</a>);
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053     <span class="keywordflow">else</span> {
<a name="l01054"></a>01054         <a class="code" href="classEGS__AdvancedApplication.html#a465e2a5ddb90f3b99b4949ca80cd531f" title="RNG buffer.">rng_buffer</a> = <span class="keyword">new</span> EGS_Float [np];
<a name="l01055"></a>01055         <a class="code" href="classEGS__AdvancedApplication.html#acaf275fb4a58347356e836a1b9122d0e" title="Size of the RNG buffer.">n_rng_buffer</a> = np;
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057     <a class="code" href="classEGS__AdvancedApplication.html#a4af9fc31aae580898acbe3d11e0bc706" title="Pointer to the RNG buffer.">i_rng_buffer</a> = ip;
<a name="l01058"></a>01058     egsGetRNGArray(<a class="code" href="classEGS__AdvancedApplication.html#a465e2a5ddb90f3b99b4949ca80cd531f" title="RNG buffer.">rng_buffer</a>);
<a name="l01059"></a>01059 }
<a name="l01060"></a>01060 
<a name="l01061"></a><a class="code" href="classEGS__AdvancedApplication.html#af5c93db48d91102183fa12d3fa9c2880">01061</a> <span class="keywordtype">void</span> <a class="code" href="classEGS__AdvancedApplication.html#af5c93db48d91102183fa12d3fa9c2880">EGS_AdvancedApplication::resetRNGState</a>() {
<a name="l01062"></a>01062     <a class="code" href="classEGS__Application.html#a1ae856ff8e9615b6f353f4d501d1d5b7" title="the random number generator">rndm</a>-&gt;<a class="code" href="classEGS__RandomGenerator.html#adff150c978435386c46de93f69b11e2d" title="Reset the state to a previously saved state.">resetState</a>();
<a name="l01063"></a>01063     <span class="keywordflow">if</span> (<a class="code" href="classEGS__AdvancedApplication.html#acaf275fb4a58347356e836a1b9122d0e" title="Size of the RNG buffer.">n_rng_buffer</a> &gt; 0) {
<a name="l01064"></a>01064         egsSetRNGState(&amp;<a class="code" href="classEGS__AdvancedApplication.html#a4af9fc31aae580898acbe3d11e0bc706" title="Pointer to the RNG buffer.">i_rng_buffer</a>,<a class="code" href="classEGS__AdvancedApplication.html#a465e2a5ddb90f3b99b4949ca80cd531f" title="RNG buffer.">rng_buffer</a>);
<a name="l01065"></a>01065     }
<a name="l01066"></a>01066 }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 <span class="comment">//************************************************************</span>
<a name="l01069"></a>01069 <span class="comment">// Utility functions for use with ausgab dose scoring objects</span>
<a name="l01070"></a>01070 <span class="comment">//************************************************************</span>
<a name="l01071"></a>01071 <span class="comment">// Returns density for medium ind</span>
<a name="l01072"></a>01072 EGS_Float EGS_AdvancedApplication::getMediumRho(<span class="keywordtype">int</span> ind) {
<a name="l01073"></a>01073     <span class="keywordflow">return</span> <a class="code" href="egs__interface2_8h.html#adc1ae9778a08795ce2b801552c53ce61" title="The address of the mortran MEDIA common block as a pointer to a C-structure of type EGS_Media...">the_media</a>-&gt;<a class="code" href="structEGS__Media.html#aee0fb145556168d50fcce1528834f7e6">rho</a>[ind];
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 <span class="comment">// Returns edep</span>
<a name="l01076"></a>01076 EGS_Float EGS_AdvancedApplication::getEdep() {
<a name="l01077"></a>01077     <span class="keywordflow">return</span> <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a4a37133c1fbcbfe96cffab989a9c2633">edep</a>;
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 <span class="comment">//************************************************************</span>
<a name="l01080"></a>01080 
<a name="l01081"></a><a class="code" href="egs__interface2_8h.html#a30933decb283ed4bb3b00e0031e156b1">01081</a> <span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> <a class="code" href="egs__interface2_8h.html#ae9d1994350c514399f2b095162b19c3a">egsHowfar</a>() {
<a name="l01082"></a>01082     CHECK_GET_APPLICATION(app,<span class="stringliteral">&quot;egsHowfar()&quot;</span>);
<a name="l01083"></a>01083     <span class="keywordtype">int</span> np = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#af5e322d06055d31869c5c45cb6e462d1">np</a>-1;
<a name="l01084"></a>01084     <span class="keywordtype">int</span> ireg = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a7b57f3b0571707c6bb4cb4f65720af75">ir</a>[np]-2;
<a name="l01085"></a>01085     <span class="keywordflow">if</span> (ireg &lt; 0 || the_stack-&gt;wt[np] == 0) {
<a name="l01086"></a>01086         <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a97dd453ed1bdf4249637200e9fda7f61">idisc</a> = 1;
<a name="l01087"></a>01087         <span class="keywordflow">return</span>;
<a name="l01088"></a>01088     }
<a name="l01089"></a>01089     <span class="keywordtype">int</span> newmed;
<a name="l01090"></a>01090     EGS_Float tsave = <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a497d0aef070a51aa288c70e2d2e4851c">ustep</a>;
<a name="l01091"></a>01091     <span class="keywordtype">int</span> inew = app-&gt;howfar(ireg,
<a name="l01092"></a>01092                            <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a3e1893b08c58c1930215b05ffd3b200c">x</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abaeb3b4d4df09253d62ecf9c866a75b5">y</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a039c1ec16171ca522ded52bbfa220ec9">z</a>[np]),
<a name="l01093"></a>01093                            <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abcce3249128b99879d88aefc0e747adb">u</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a74269a7153ecdc20f966ac7e7a4900e3">v</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a792b83be2582af5596c36966e634d748">w</a>[np]),
<a name="l01094"></a>01094                            <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a497d0aef070a51aa288c70e2d2e4851c">ustep</a>,&amp;newmed);
<a name="l01095"></a>01095 <span class="preprocessor">#ifdef GDEBUG</span>
<a name="l01096"></a>01096 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (steps_n &lt; MAX_STEP) {
<a name="l01097"></a>01097         steps_x[steps_n] =
<a name="l01098"></a>01098             <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a3e1893b08c58c1930215b05ffd3b200c">x</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abaeb3b4d4df09253d62ecf9c866a75b5">y</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a039c1ec16171ca522ded52bbfa220ec9">z</a>[np]);
<a name="l01099"></a>01099         steps_u[steps_n] =
<a name="l01100"></a>01100             <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abcce3249128b99879d88aefc0e747adb">u</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a74269a7153ecdc20f966ac7e7a4900e3">v</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a792b83be2582af5596c36966e634d748">w</a>[np]);
<a name="l01101"></a>01101         steps_ireg[steps_n] = ireg;
<a name="l01102"></a>01102         steps_inew[steps_n] = inew;
<a name="l01103"></a>01103         steps_ustepi[steps_n] = tsave;
<a name="l01104"></a>01104         steps_ustepf[steps_n++] = <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a497d0aef070a51aa288c70e2d2e4851c">ustep</a>;
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106     <span class="keywordflow">if</span> (<a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a497d0aef070a51aa288c70e2d2e4851c">ustep</a> &lt; -1e-4) {
<a name="l01107"></a>01107         <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;Negative step: %g\n&quot;</span>,<a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a497d0aef070a51aa288c70e2d2e4851c">ustep</a>);
<a name="l01108"></a>01108         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;steps_n; j++)
<a name="l01109"></a>01109             <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(<span class="stringliteral">&quot;%d x=(%g,%g,%g) u=(%g,%g,%g) ireg=%d inew=%d ustepi=%g&quot;</span>
<a name="l01110"></a>01110                        <span class="stringliteral">&quot; ustepf=%g\n&quot;</span>,j,steps_x[j].x,steps_x[j].y,steps_x[j].z,
<a name="l01111"></a>01111                        steps_u[j].x,steps_u[j].y,steps_u[j].z,
<a name="l01112"></a>01112                        steps_ireg[j],steps_inew[j],steps_ustepi[j],
<a name="l01113"></a>01113                        steps_ustepf[j]);
<a name="l01114"></a>01114         exit(1);
<a name="l01115"></a>01115     }
<a name="l01116"></a>01116 <span class="preprocessor">#endif</span>
<a name="l01117"></a>01117 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (inew != ireg) {
<a name="l01118"></a>01118         <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#aeb1311ded669a1d31986959c7b8657e6">irnew</a> = inew+2;
<a name="l01119"></a>01119         <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#aac702891b8384544f80c50b65e5704e9" title="Medium in the new region.">medium_new</a> = newmed+1;
<a name="l01120"></a>01120         app-&gt;enterNewRegion();
<a name="l01121"></a>01121         <span class="keywordflow">if</span> (inew &lt; 0) {
<a name="l01122"></a>01122             <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a97dd453ed1bdf4249637200e9fda7f61">idisc</a> = -1; <span class="comment">// i.e. discard after the step.</span>
<a name="l01123"></a>01123             <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#aac702891b8384544f80c50b65e5704e9" title="Medium in the new region.">medium_new</a> = 0;
<a name="l01124"></a>01124         }
<a name="l01125"></a>01125     }
<a name="l01126"></a>01126 }
<a name="l01127"></a>01127 
<a name="l01128"></a><a class="code" href="egs__interface2_8h.html#a138ea8c322af28b53c235b03212f2e45">01128</a> <span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> <a class="code" href="egs__interface2_8h.html#aa05957265d0dca6af23a26ddab929353">egsHownear</a>(EGS_Float *tperp) {
<a name="l01129"></a>01129     CHECK_GET_APPLICATION(app,<span class="stringliteral">&quot;egsHownear()&quot;</span>);
<a name="l01130"></a>01130     <span class="keywordtype">int</span> np = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#af5e322d06055d31869c5c45cb6e462d1">np</a>-1;
<a name="l01131"></a>01131     <span class="keywordtype">int</span> ireg = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a7b57f3b0571707c6bb4cb4f65720af75">ir</a>[np]-2;
<a name="l01132"></a>01132     *tperp = app-&gt;hownear(ireg,<a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a3e1893b08c58c1930215b05ffd3b200c">x</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abaeb3b4d4df09253d62ecf9c866a75b5">y</a>[np],
<a name="l01133"></a>01133                                           <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a039c1ec16171ca522ded52bbfa220ec9">z</a>[np]));
<a name="l01134"></a>01134 }
<a name="l01135"></a>01135 
<a name="l01136"></a><a class="code" href="egs__interface2_8h.html#aa970cbc63a9de01aaf51d8d1af3553b6">01136</a> <span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> <a class="code" href="egs__interface2_8h.html#ab56edf34e97a21f231b7122a5ab0793b">egsFillRandomArray</a>(<span class="keyword">const</span> EGS_I32 *n, EGS_Float *rarray) {
<a name="l01137"></a>01137     CHECK_GET_APPLICATION(app,<span class="stringliteral">&quot;egsFillRandomArray()&quot;</span>);
<a name="l01138"></a>01138     app-&gt;fillRandomArray(*n,rarray);
<a name="l01139"></a>01139 }
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 <span class="comment">//extern __extc__ int egsAusgab(const EGS_I32 *iarg) {</span>
<a name="l01142"></a>01142 <span class="comment">//    CHECK_GET_APPLICATION(app,&quot;egsAusgab()&quot;);</span>
<a name="l01143"></a>01143 <span class="comment">//    return app-&gt;ausgab(*iarg);</span>
<a name="l01144"></a>01144 <span class="comment">//}</span>
<a name="l01145"></a><a class="code" href="egs__interface2_8h.html#a36bcdfd3a140c9164dc78d9ba45ab9dd">01145</a> <span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> <a class="code" href="egs__interface2_8h.html#a75b593ec6e54183930fa8a43abec3824">egsAusgab</a>(EGS_I32 *iarg) {
<a name="l01146"></a>01146     CHECK_GET_APPLICATION(app,<span class="stringliteral">&quot;egsAusgab()&quot;</span>);
<a name="l01147"></a>01147     <span class="comment">//*iarg = app-&gt;ausgab(*iarg);</span>
<a name="l01148"></a>01148     <span class="keywordtype">int</span> np = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#af5e322d06055d31869c5c45cb6e462d1">np</a>-1;
<a name="l01149"></a>01149     app-&gt;top_p.E = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a054b5f967362fb583b08aa141d44d274">E</a>[np];
<a name="l01150"></a>01150     app-&gt;top_p.wt = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abde65475db0a8c4350dadf06a7ac2375">wt</a>[np];
<a name="l01151"></a>01151     app-&gt;top_p.x = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a3e1893b08c58c1930215b05ffd3b200c">x</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abaeb3b4d4df09253d62ecf9c866a75b5">y</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a039c1ec16171ca522ded52bbfa220ec9">z</a>[np]);
<a name="l01152"></a>01152     app-&gt;top_p.u = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#abcce3249128b99879d88aefc0e747adb">u</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a74269a7153ecdc20f966ac7e7a4900e3">v</a>[np],<a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a792b83be2582af5596c36966e634d748">w</a>[np]);
<a name="l01153"></a>01153     app-&gt;top_p.q = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a9a8a5f250531ac78188175d4903abd4d">iq</a>[np];
<a name="l01154"></a>01154     app-&gt;top_p.ir = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a7b57f3b0571707c6bb4cb4f65720af75">ir</a>[np]-2;
<a name="l01155"></a>01155     app-&gt;top_p.latch = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#afaaf57ba783e01b7f0a0aeb6fbe0447c">latch</a>[np];
<a name="l01156"></a>01156     app-&gt;Np = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#af5e322d06055d31869c5c45cb6e462d1">np</a>-1;
<a name="l01157"></a>01157     *iarg = app-&gt;userScoring(*iarg);
<a name="l01158"></a>01158 }
<a name="l01159"></a>01159 
<a name="l01160"></a><a class="code" href="egs__interface2_8h.html#a9b167c4adfdb11c3e5fbbb1779aab30b">01160</a> <span class="keyword">extern</span> __extc__ <span class="keywordtype">void</span> <a class="code" href="egs__interface2_8h.html#a5dc22049f8640c3a6b5f7a616bc01e2e">egsStartParticle</a>() {
<a name="l01161"></a>01161     CHECK_GET_APPLICATION(app,<span class="stringliteral">&quot;egsStartParticle()&quot;</span>);
<a name="l01162"></a>01162     <span class="keywordtype">int</span> np = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#af5e322d06055d31869c5c45cb6e462d1">np</a> - 1;
<a name="l01163"></a>01163     <span class="keywordtype">int</span> ir = <a class="code" href="egs__interface2_8h.html#ad3c6fd2b0e445d2273263b64cb2e4d74" title="The address of the mortran STACK common block as a pointer to a C-structure of type EGS_Stack...">the_stack</a>-&gt;<a class="code" href="structEGS__Stack.html#a7b57f3b0571707c6bb4cb4f65720af75">ir</a>[np]-2;
<a name="l01164"></a>01164     <span class="keywordflow">if</span> (ir &lt; 0) {
<a name="l01165"></a>01165         <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a97dd453ed1bdf4249637200e9fda7f61">idisc</a> = 1;
<a name="l01166"></a>01166         <span class="keywordflow">return</span>;
<a name="l01167"></a>01167     }
<a name="l01168"></a>01168     <a class="code" href="egs__interface2_8h.html#a0e5931e71c4f14d863e2fe3a5f508e14" title="The address of the mortran EPCONT common block as a pointer to a C-structure of type EGS_Epcont...">the_epcont</a>-&gt;<a class="code" href="structEGS__Epcont.html#a97dd453ed1bdf4249637200e9fda7f61">idisc</a> = 0;
<a name="l01169"></a>01169     <a class="code" href="egs__interface2_8h.html#a0672b754e821b69e7fb77eff1c412bc9" title="The address of the mortran USEFUL common block as a pointer to a C-structure of type EGS_Useful...">the_useful</a>-&gt;<a class="code" href="structEGS__Useful.html#a5d287eb116a7afc3c3843068e34fb747" title="Current medium.">medium</a> = app-&gt;getMedium(ir)+1;
<a name="l01170"></a>01170     <span class="comment">//egsInformation(&quot;start particle: ir=%d medium=%d\n&quot;,ir,the_useful-&gt;medium);</span>
<a name="l01171"></a>01171     app-&gt;startNewParticle();
<a name="l01172"></a>01172 }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
